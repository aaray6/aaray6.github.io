<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="vaultwarden 用docker搭建vaultwarden(bitwarden)服务器"><meta name="keywords" content=""><meta name="author" content="Ray Qu"><meta name="copyright" content="Ray Qu"><title>vaultwarden 用docker搭建vaultwarden(bitwarden)服务器 | My Notes</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 7.3.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85vaultwarden"><span class="toc-number">1.</span> <span class="toc-text">安装vaultwarden</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-compose-yml"><span class="toc-number">1.1.</span> <span class="toc-text">docker-compose.yml</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AEfrp"><span class="toc-number">2.</span> <span class="toc-text">设置frp</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF"><span class="toc-number">2.1.</span> <span class="toc-text">服务器端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AFsystemd%E6%8E%A7%E5%88%B6%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.2.</span> <span class="toc-text">服务器端systemd控制服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">2.3.</span> <span class="toc-text">客户端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AFsystemd%E6%8E%A7%E5%88%B6%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.4.</span> <span class="toc-text">客户端systemd控制服务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%91%E5%AE%9A%E5%9F%9F%E5%90%8D"><span class="toc-number">3.</span> <span class="toc-text">绑定域名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Caddy%E6%98%A0%E5%B0%84"><span class="toc-number">4.</span> <span class="toc-text">Caddy映射</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E6%96%B0%E5%B8%90%E5%8F%B7"><span class="toc-number">5.</span> <span class="toc-text">注册新帐号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E6%B3%A8%E5%86%8C%E5%B8%90%E5%8F%B7%E5%8A%9F%E8%83%BD"><span class="toc-number">6.</span> <span class="toc-text">关闭注册帐号功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%80%E5%9F%9F%E7%BD%91%E6%98%A0%E5%B0%84HTTPS%E8%AE%BF%E9%97%AE"><span class="toc-number">7.</span> <span class="toc-text">局域网映射HTTPS访问</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">8.</span> <span class="toc-text">参考</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Ray Qu</div><div class="author-info__description text-center">My Tech Notes and Other stuff</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">76</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">My Notes</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/about.html">About</a><a class="site-page" href="/contact.html">Contact</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">vaultwarden 用docker搭建vaultwarden(bitwarden)服务器</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-01-25</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="安装vaultwarden"><a href="#安装vaultwarden" class="headerlink" title="安装vaultwarden"></a>安装vaultwarden</h2><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd</span><br><span class="line">mkdir -p docker/vaultwarden/data</span><br><span class="line">docker pull vaultwarden/server:latest</span><br><span class="line">docker run -d --name vaultwarden -v ~/docker/vaultwarden/data/:/data/ -p 11080:80 vaultwarden/server:latest</span><br></pre></td></tr></table></figure>

<p>如果需要备份，~&#x2F;docker&#x2F;vaultwarden&#x2F;data目录下有所有需要备份的内容。</p>
<h3 id="docker-compose-yml"><a href="#docker-compose-yml" class="headerlink" title="docker-compose.yml"></a>docker-compose.yml</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;2.1&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">vaultwarden:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">vaultwarden/server:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">vaultwarden</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">~/docker/vaultwarden/data/:/data/</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">11080</span><span class="string">:80</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br></pre></td></tr></table></figure>

<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure>

<h2 id="设置frp"><a href="#设置frp" class="headerlink" title="设置frp"></a>设置frp</h2><h3 id="服务器端"><a href="#服务器端" class="headerlink" title="服务器端"></a>服务器端</h3><p>打开防火墙8888端口。</p>
<p>下载frp (<a href="https://github.com/fatedier/frp">https://github.com/fatedier/frp</a>)</p>
<p>解压文件。修改frps.ini</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">8888</span></span><br><span class="line"><span class="attr">token</span> = &lt;password&gt;</span><br></pre></td></tr></table></figure>

<p>运行</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">./frps -c frps.ini &amp;</span><br><span class="line">2023/01/24 16:11:38 [I] [root.go:206] frps uses config file: frps.ini</span><br><span class="line">2023/01/24 16:11:38 [I] [service.go:200] frps tcp listen on 0.0.0.0:8888</span><br><span class="line">2023/01/24 16:11:38 [I] [root.go:215] frps started successfully</span><br></pre></td></tr></table></figure>

<h3 id="服务器端systemd控制服务"><a href="#服务器端systemd控制服务" class="headerlink" title="服务器端systemd控制服务"></a>服务器端systemd控制服务</h3><blockquote>
<p><a href="https://gofrp.org/docs/setup/systemd/">https://gofrp.org/docs/setup/systemd/</a></p>
</blockquote>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/systemd/system/frps.service</span><br></pre></td></tr></table></figure>

<p>文件内容如下</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=Frp Server Service</span><br><span class="line"><span class="attr">After</span>=network.target syslog.target</span><br><span class="line"><span class="attr">Wants</span>=network.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=simple</span><br><span class="line"><span class="attr">Restart</span>=<span class="literal">on</span>-failure</span><br><span class="line"><span class="attr">RestartSec</span>=<span class="number">5</span>s</span><br><span class="line"><span class="attr">ExecStart</span>=/home/ubuntu/frp/frps -c /home/ubuntu/frp/frps.ini</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure>

<p>使用 systemd 命令，管理 frps</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动frp</span></span><br><span class="line">sudo systemctl start frps</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">停止frp</span></span><br><span class="line">sudo systemctl stop frps</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启frp</span></span><br><span class="line">sudo systemctl restart frps</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看frp状态</span></span><br><span class="line">systemctl status frps</span><br></pre></td></tr></table></figure>

<p>配置 frps 开机自启。</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable frps</span><br></pre></td></tr></table></figure>

<h3 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h3><p>下载frp (<a href="https://github.com/fatedier/frp)%E3%80%82%E5%9B%A0%E4%B8%BA%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%98%AFarmbian,%E6%89%80%E4%BB%A5%E9%9C%80%E8%A6%81%E4%B8%8B%E8%BD%BDarm64%E7%89%88%E6%9C%AC%E7%9A%84%E3%80%82">https://github.com/fatedier/frp)。因为客户端是armbian,所以需要下载arm64版本的。</a></p>
<p>解压文件。修改frpc.ini</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = &lt;server ip&gt;</span><br><span class="line"><span class="attr">server_port</span> = <span class="number">8888</span></span><br><span class="line"><span class="attr">token</span> = &lt;password&gt;</span><br><span class="line"></span><br><span class="line"><span class="section">[vaultwarden]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">11080</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">11080</span></span><br></pre></td></tr></table></figure>

<p>运行</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./frpc -c frpc.ini&amp;</span><br></pre></td></tr></table></figure>

<h3 id="客户端systemd控制服务"><a href="#客户端systemd控制服务" class="headerlink" title="客户端systemd控制服务"></a>客户端systemd控制服务</h3><blockquote>
<p><a href="https://gist.github.com/imyelo/b6c3d3d9383f7d5623f06a0c11052530">https://gist.github.com/imyelo/b6c3d3d9383f7d5623f06a0c11052530</a></p>
</blockquote>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/systemd/system/frpc.service</span><br></pre></td></tr></table></figure>

<p>文件内容如下</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. put frpc and frpc.ini under /usr/local/frpc/</span></span><br><span class="line"><span class="comment"># 2. put this file (frpc.service) at /etc/systemd/system</span></span><br><span class="line"><span class="comment"># 3. run `sudo systemctl daemon-reload &amp;&amp; sudo systemctl enable frpc &amp;&amp; sudo systemctl start frpc`</span></span><br><span class="line"><span class="comment"># Then we can manage frpc with `sudo service frpc &#123;start|stop|restart|status&#125;`</span></span><br><span class="line"><span class="comment"># See also: https://nosame.net/use-frp-to-reverse-proxy-your-nas/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Alternative for server:</span></span><br><span class="line"><span class="comment"># - Offical: https://github.com/fatedier/frp/blob/a4cfab6/conf/systemd/frpc%40.service</span></span><br><span class="line"></span><br><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=Frp Client Service</span><br><span class="line"><span class="attr">After</span>=network.target</span><br><span class="line"><span class="attr">Wants</span>=network.target network-<span class="literal">on</span>line.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=simple</span><br><span class="line"><span class="attr">Restart</span>=<span class="literal">on</span>-failure</span><br><span class="line"><span class="attr">RestartSec</span>=<span class="number">5</span>s</span><br><span class="line"><span class="attr">ExecStart</span>=/home/user/frp/frpc -c /home/user/frp/frpc.ini</span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure>

<p>使用 systemd 命令，管理 frpc</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动frp</span></span><br><span class="line">sudo systemctl start frpc</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">停止frp</span></span><br><span class="line">sudo systemctl stop frpc</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启frp</span></span><br><span class="line">sudo systemctl restart frpc</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看frp状态</span></span><br><span class="line">systemctl status frpc</span><br></pre></td></tr></table></figure>

<p>配置 frps 开机自启。</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable frpc</span><br></pre></td></tr></table></figure>

<h2 id="绑定域名"><a href="#绑定域名" class="headerlink" title="绑定域名"></a>绑定域名</h2><p>noip.com申请免费域名并绑定服务器IP地址。</p>
<h2 id="Caddy映射"><a href="#Caddy映射" class="headerlink" title="Caddy映射"></a>Caddy映射</h2><p>Caddy是跟Nginx类似的web服务器。用Caddy可以做到自动申请letsencrypt证书。我服务器的Caddy版本是v1版本，所以配置文件格式是老格式。</p>
<p>在Caddyfile文件根中增加如下一段</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&lt;绑定的域名&gt;</span> &#123;</span><br><span class="line">    <span class="string">proxy</span> <span class="string">/</span> <span class="string">http://10.0.0.32:11080</span> &#123;</span><br><span class="line">        <span class="string">transparent</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的10.0.0.32是服务器内网IP地址。11080是通过frp映射的端口号。</p>
<h2 id="注册新帐号"><a href="#注册新帐号" class="headerlink" title="注册新帐号"></a>注册新帐号</h2><p>浏览器打开https:&#x2F;&#x2F;域名访问vaultwarden。注册新帐号。</p>
<h2 id="关闭注册帐号功能"><a href="#关闭注册帐号功能" class="headerlink" title="关闭注册帐号功能"></a>关闭注册帐号功能</h2><p>停止并删除vaultwarden container，并用以下命令重新运行vaultwarden</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name vaultwarden -e SIGNUPS_ALLOWED=false -v ~/docker/vaultwarden/data/:/data/ -p 11080:80 vaultwarden/server:latest</span><br></pre></td></tr></table></figure>

<h2 id="局域网映射HTTPS访问"><a href="#局域网映射HTTPS访问" class="headerlink" title="局域网映射HTTPS访问"></a>局域网映射HTTPS访问</h2><p>整个服务过于复杂，依赖</p>
<ol>
<li>本地服务器</li>
<li>本地网络</li>
<li>公网服务器</li>
<li>FPR服务器和客户端</li>
<li>Caddy</li>
</ol>
<p>为防止服务不可用，设置在局域网访问。服务本身是HTTP协议11080端口。但是服务却不允许通过HTTP访问，必须通过HTTPS访问。<br>利用nginx设置反向代理通过HTTPS端口11443的步骤如下。</p>
<blockquote>
<p><a href="https://www.techrepublic.com/article/how-to-enable-ssl-on-nginx/">https://www.techrepublic.com/article/how-to-enable-ssl-on-nginx/</a></p>
</blockquote>
<ol>
<li>安装nginx</li>
</ol>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install nginx</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>生成自签名证书</li>
</ol>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo openssl req -x509 -nodes -days 9365 -newkey rsa:2048 -keyout /etc/ssl/private/nginx-selfsigned.key -out /etc/ssl/certs/nginx-selfsigned.crt</span><br></pre></td></tr></table></figure>

<p>提示Common Name的时候输入IP地址</p>
<ol start="3">
<li>配置nginx</li>
</ol>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/nginx/snippets/self-signed.conf</span><br></pre></td></tr></table></figure>

<p>文件内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssl_certificate /etc/ssl/certs/nginx-selfsigned.crt;</span><br><span class="line">ssl_certificate_key /etc/ssl/private/nginx-selfsigned.key;</span><br></pre></td></tr></table></figure>

<p>然后，生成另外一个配置文件</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/nginx/snippets/ssl-params.conf</span><br></pre></td></tr></table></figure>

<p>内容如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ssl_protocols TLSv1.2;</span><br><span class="line">ssl_prefer_server_ciphers on;</span><br><span class="line">ssl_dhparam /etc/ssl/certs/dhparam.pem;</span><br><span class="line">ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384;</span><br><span class="line">ssl_ecdh_curve secp384r1; # Requires nginx &gt;= 1.1.0</span><br><span class="line">ssl_session_timeout 10m;</span><br><span class="line">ssl_session_cache shared:SSL:10m;</span><br><span class="line">ssl_session_tickets off; # Requires nginx &gt;= 1.5.9</span><br><span class="line"># ssl_stapling on; # Requires nginx &gt;= 1.3.7</span><br><span class="line"># ssl_stapling_verify on; # Requires nginx =&gt; 1.3.7</span><br><span class="line">resolver 8.8.8.8 8.8.4.4 valid=300s;</span><br><span class="line">resolver_timeout 5s;</span><br><span class="line">add_header X-Frame-Options DENY;</span><br><span class="line">add_header X-Content-Type-Options nosniff;</span><br><span class="line">add_header X-XSS-Protection &quot;1; mode=block&quot;;</span><br></pre></td></tr></table></figure>

<p>生成dhparam.pem文件</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo openssl dhparam -out /etc/ssl/certs/dhparam.pem 2048</span><br></pre></td></tr></table></figure>

<p>生成nginx配置文件myproxy</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/nginx/sites-available/myproxy</span><br></pre></td></tr></table></figure>

<p>内容如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">	listen 11443 ssl;</span><br><span class="line">	listen [::]:11443 ssl;</span><br><span class="line">	include snippets/self-signed.conf;</span><br><span class="line">	include snippets/ssl-params.conf;</span><br><span class="line"></span><br><span class="line">	server_name _;</span><br><span class="line"></span><br><span class="line">	location / &#123;</span><br><span class="line">		proxy_pass http://localhost:11080;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>替换配置文件,重启nginx</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/nginx/sites-enabled/</span><br><span class="line">sudo rm default </span><br><span class="line">sudo ln -s /etc/nginx/sites-available/myproxy myproxy</span><br><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure>

<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><blockquote>
<p><a href="https://www.hash070.top/archives/bitwarden-docker-deploy.html">https://www.hash070.top/archives/bitwarden-docker-deploy.html</a><br><a href="https://hub.docker.com/r/vaultwarden/server">https://hub.docker.com/r/vaultwarden/server</a></p>
</blockquote>
</div></article><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2023/01/28/paperless-ngx/"><i class="fa fa-chevron-left">  </i><span>paperless-ngx</span></a></div><div class="next-post pull-right"><a href="/2022/12/14/caddy-syncthing/"><span>Docker Caddy反向代理syncthing</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2025 By Ray Qu</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>