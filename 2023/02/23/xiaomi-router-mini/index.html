<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="小米路由器mini刷breed和openwrt"><meta name="keywords" content=""><meta name="author" content="Ray Qu"><meta name="copyright" content="Ray Qu"><title>小米路由器mini刷breed和openwrt | My Notes</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 7.3.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%B1%B3%E5%8D%87%E7%BA%A7%E5%BC%80%E5%8F%91%E7%89%88%E5%9B%BA%E4%BB%B6"><span class="toc-number">1.</span> <span class="toc-text">小米升级开发版固件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%B1%B3%E5%AE%98%E6%96%B9ssh%E5%B7%A5%E5%85%B7"><span class="toc-number">2.</span> <span class="toc-text">小米官方ssh工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%91%E5%AE%9A%E8%B7%AF%E7%94%B1%E5%99%A8"><span class="toc-number">2.1.</span> <span class="toc-text">绑定路由器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E5%8C%85%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">2.2.</span> <span class="toc-text">工具包使用方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E8%B7%AF%E7%94%B1%E5%99%A8"><span class="toc-number">3.</span> <span class="toc-text">连接路由器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%87%E4%BB%BD"><span class="toc-number">4.</span> <span class="toc-text">备份</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%99%E5%85%A5breed"><span class="toc-number">5.</span> <span class="toc-text">写入breed</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#openwrt%E5%AE%98%E7%BD%91%E5%9B%BA%E4%BB%B6%E4%B8%8B%E8%BD%BD"><span class="toc-number">6.</span> <span class="toc-text">openwrt官网固件下载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5breed"><span class="toc-number">7.</span> <span class="toc-text">进入breed</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%87%E4%BB%BD%E5%8E%9F%E6%9D%A5%E7%9A%84%E5%9B%BA%E4%BB%B6"><span class="toc-number">8.</span> <span class="toc-text">备份原来的固件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%B7%E5%85%A5openwrt%E5%9B%BA%E4%BB%B6"><span class="toc-number">9.</span> <span class="toc-text">刷入openwrt固件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5openwrt"><span class="toc-number">10.</span> <span class="toc-text">进入openwrt</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E4%B8%BA%E4%B8%AD%E7%BB%A7%E6%A1%A5%E5%92%8C%E6%89%93%E5%8D%B0%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">11.</span> <span class="toc-text">设置为中继桥和打印服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%8F%92%E4%BB%B6"><span class="toc-number">11.1.</span> <span class="toc-text">安装插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%97%A0%E7%BA%BF%E4%B8%AD%E7%BB%A7"><span class="toc-number">11.2.</span> <span class="toc-text">配置无线中继</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E6%89%93%E5%8D%B0%E6%9C%BA%E6%9C%8D%E5%8A%A1"><span class="toc-number">12.</span> <span class="toc-text">设置打印机服务</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Ray Qu</div><div class="author-info__description text-center">My Tech Notes and Other stuff</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">76</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">My Notes</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/about.html">About</a><a class="site-page" href="/contact.html">Contact</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">小米路由器mini刷breed和openwrt</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-02-23</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>小米路由器mini刷breed和openwrt</p>
<blockquote>
<p><a href="https://www.right.com.cn/forum/forum.php?mod=viewthread&tid=690605">https://www.right.com.cn/forum/forum.php?mod=viewthread&amp;tid=690605</a><br><a href="https://blog.csdn.net/weixin_53742409/article/details/121676620">https://blog.csdn.net/weixin_53742409/article/details/121676620</a><br><a href="https://zhuanlan.zhihu.com/p/237513064">https://zhuanlan.zhihu.com/p/237513064</a></p>
</blockquote>
<h2 id="小米升级开发版固件"><a href="#小米升级开发版固件" class="headerlink" title="小米升级开发版固件"></a>小米升级开发版固件</h2><p>在<a href="http://www1.miwifi.com/miwifi_download.html">http://www1.miwifi.com/miwifi_download.html</a> 网页找到小米路由器mini 开发版固件并下载<br>miwifi_r1cm_firmware_2e9b9_2.21.109.bin</p>
<p><img src="https://raw.githubusercontent.com/aaray6/mygitnote_images/main/gitnote/2023/02/22/xiaomi_mini_2_devrom-1677029325096.png" alt="title"></p>
<p>在 Web 路由器管理页面的 常用设置—系统状态—升级检测—手动升级—上传安装固件—升级 ，等待安装完重启就行。如果无法进入系统，可以根据官方教程用 U 盘刷机。</p>
<p><img src="https://raw.githubusercontent.com/aaray6/mygitnote_images/main/gitnote/2023/02/22/xiaomi_mini_2_devrom_webupgrade-1677029363531.png" alt="title"></p>
<p>选择刚下载的开发版rom升级,不选择擦除旧配置,提示需要花费几分钟。</p>
<p><img src="https://raw.githubusercontent.com/aaray6/mygitnote_images/main/gitnote/2023/02/22/xiaomi_mini_1_sshtool-1677029523944.png" alt="title"></p>
<p>升级之后重新登录web控制台，显示版本号已经更新了。</p>
<p><img src="https://raw.githubusercontent.com/aaray6/mygitnote_images/main/gitnote/2023/02/22/xiaomi_mini_2_devrom_webupgrade_2-1677033255342.png" alt="title"></p>
<h2 id="小米官方ssh工具"><a href="#小米官方ssh工具" class="headerlink" title="小米官方ssh工具"></a>小米官方ssh工具</h2><h3 id="绑定路由器"><a href="#绑定路由器" class="headerlink" title="绑定路由器"></a>绑定路由器</h3><p>注册小米账号<br>去 Miwifi.com 下载手机客户端并登陆<br>绑定路由器<br>打开 <a href="http://d.miwifi.com/rom/ssh">http://d.miwifi.com/rom/ssh</a> 并登陆获取路由器的 root 密码及工具包</p>
<p>注: 如果chrome浏览器无法下载，换firefox浏览器。</p>
<p>小米ID：86nnn39<br>已绑定1台小米路由器<br>RAY3(小米路由器mini)root密码 2cxxxxx8</p>
<h3 id="工具包使用方法"><a href="#工具包使用方法" class="headerlink" title="工具包使用方法"></a>工具包使用方法</h3><p>工具包使用方法：小米路由器需升级到开发版0.5.28及以上，小米路由器mini需升级到开发版0.3.84及以上，小米路由器3即将支持。注意：稳定版不支持。<br>请将下载的工具包bin文件复制到U盘（FAT&#x2F;FAT32格式）的根目录下，保证文件名为miwifi_ssh.bin；<br>断开小米路由器的电源，将U盘插入USB接口；<br>按住reset按钮之后重新接入电源，指示灯变为黄色闪烁状态即可松开reset键；<br>等待3-5秒后安装完成之后，小米路由器会自动重启，之后您就可以尽情折腾啦 ：）</p>
<h2 id="连接路由器"><a href="#连接路由器" class="headerlink" title="连接路由器"></a>连接路由器</h2><p>用具有 SSH 功能的软件连接路由器，小米路由器的默认 IP段 都是 192.168.31.x</p>
<p>但因为我之前升级开发版固件时保留了设置，所以IP没变，还是192.168.1.1。用户名root,密码是上一步获得的密码。</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">~$ </span><span class="language-bash">ssh root@192.168.1.1</span></span><br><span class="line">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="line">@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @</span><br><span class="line">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="line">IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!</span><br><span class="line">Someone could be eavesdropping on you right now (man-in-the-middle attack)!</span><br><span class="line">It is also possible that a host key has just been changed.</span><br><span class="line">The fingerprint for the RSA key sent by the remote host is</span><br><span class="line">SHA256:TMdKPyzK1rPxHy+/OYVcCsLMVZGEGtpmABnRw1DgDlQ.</span><br><span class="line">Please contact your system administrator.</span><br><span class="line">Add correct host key in ~/.ssh/known_hosts to get rid of this message.</span><br><span class="line">Offending ED25519 key in ~/.ssh/known_hosts:62</span><br><span class="line">  remove with:</span><br><span class="line">  ssh-keygen -f &quot;~/.ssh/known_hosts&quot; -R &quot;192.168.1.1&quot;</span><br><span class="line">RSA host key for 192.168.1.1 has changed and you have requested strict checking.</span><br><span class="line">Host key verification failed.</span><br><span class="line"><span class="meta prompt_">~$ </span><span class="language-bash">ssh-keygen -f <span class="string">&quot;~/.ssh/known_hosts&quot;</span> -R <span class="string">&quot;192.168.1.1&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Host 192.168.1.1 found: line 62</span></span><br><span class="line">~/.ssh/known_hosts updated.</span><br><span class="line">Original contents retained as ~/.ssh/known_hosts.old</span><br><span class="line"><span class="meta prompt_">~$ </span><span class="language-bash">ssh root@192.168.1.1</span></span><br><span class="line">The authenticity of host &#x27;192.168.1.1 (192.168.1.1)&#x27; can&#x27;t be established.</span><br><span class="line">RSA key fingerprint is SHA256:TMdKPyzK1rPxHy+/OYVcCsLMVZGEGtpmABnRw1DgDlQ.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="line">Warning: Permanently added &#x27;192.168.1.1&#x27; (RSA) to the list of known hosts.</span><br><span class="line">root@192.168.1.1&#x27;s password: </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BusyBox v1.19.4 (2018-06-21 09:07:05 UTC) built-in shell (ash)</span><br><span class="line">Enter &#x27;help&#x27; for a list of built-in commands.</span><br><span class="line"></span><br><span class="line"> -----------------------------------------------------</span><br><span class="line">       Welcome to XiaoQiang!</span><br><span class="line"> -----------------------------------------------------</span><br><span class="line"><span class="meta prompt_">  $</span><span class="language-bash">$$$$$\  $$$$$$$\  $$$$$$$$\      $$\      $$\        $$$$$$\  $$\   $$\</span></span><br><span class="line"><span class="language-bash"> $$  __$$\ $$  __$$\ $$  _____|     $$ |     $$ |      $$  __$$\ $$ | $$  |</span></span><br><span class="line"><span class="meta prompt_"> $</span><span class="language-bash">$ /  $$ |$$ |  $$ |$$ |           $$ |     $$ |      $$ /  $$ |$$ |$$  /</span></span><br><span class="line"><span class="meta prompt_"> $</span><span class="language-bash">$$$$$$$ |$$$$$$$  |$$$$$\         $$ |     $$ |      $$ |  $$ |$$$$$  /</span></span><br><span class="line"><span class="meta prompt_"> $</span><span class="language-bash">$  __$$ |$$  __$$&lt; $$  __|        $$ |     $$ |      $$ |  $$ |$$  $$&lt;</span></span><br><span class="line"><span class="meta prompt_"> $</span><span class="language-bash">$ |  $$ |$$ |  $$ |$$ |           $$ |     $$ |      $$ |  $$ |$$ |\$$\</span></span><br><span class="line"><span class="language-bash"> $$ |  $$ |$$ |  $$ |$$$$$$$$\       $$$$$$$$$  |       $$$$$$  |$$ | \$$\</span></span><br><span class="line"><span class="language-bash"> \__|  \__|\__|  \__|\________|      \_________/        \______/ \__|  \__|</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@XiaoQiang:~# </span><br></pre></td></tr></table></figure>

<h2 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h2><p>&#x2F;dev&#x2F;sda1是U盘，自动mount在&#x2F;extdisks&#x2F;sda1。<br>用dd命令备份到U盘上。</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">root@XiaoQiang:~# df -h</span><br><span class="line">Filesystem                Size      Used Available Use% Mounted on</span><br><span class="line">rootfs                   10.8M     10.8M         0 100% /</span><br><span class="line">/dev/root                10.8M     10.8M         0 100% /</span><br><span class="line">tmpfs                    61.0M    968.0K     60.0M   2% /tmp</span><br><span class="line">tmpfs                   512.0K         0    512.0K   0% /dev</span><br><span class="line">tmpfs                    61.0M    968.0K     60.0M   2% /extdisks</span><br><span class="line">/dev/mtdblock7            1.0M    772.0K    252.0K  75% /data</span><br><span class="line">/dev/mtdblock7            1.0M    772.0K    252.0K  75% /etc</span><br><span class="line">tmpfs                    61.0M    968.0K     60.0M   2% /userdisk/sysapihttpd</span><br><span class="line">/dev/sda1               116.4G      9.2G    107.2G   8% /extdisks/sda1</span><br><span class="line">/dev/root                 1.0M    772.0K    252.0K  75% /mnt</span><br><span class="line">/dev/mtdblock7            1.0M    772.0K    252.0K  75% /mnt</span><br><span class="line">root@XiaoQiang:~# cat /proc/mtd</span><br><span class="line">dev:    size   erasesize  name</span><br><span class="line">mtd0: 01000000 00010000 &quot;ALL&quot;</span><br><span class="line">mtd1: 00030000 00010000 &quot;Bootloader&quot;</span><br><span class="line">mtd2: 00010000 00010000 &quot;Config&quot;</span><br><span class="line">mtd3: 00010000 00010000 &quot;Factory&quot;</span><br><span class="line">mtd4: 00c80000 00010000 &quot;OS1&quot;</span><br><span class="line">mtd5: 00b178a7 00010000 &quot;rootfs&quot;</span><br><span class="line">mtd6: 00200000 00010000 &quot;OS2&quot;</span><br><span class="line">mtd7: 00100000 00010000 &quot;overlay&quot;</span><br><span class="line">mtd8: 00010000 00010000 &quot;crash&quot;</span><br><span class="line">mtd9: 00010000 00010000 &quot;reserved&quot;</span><br><span class="line">mtd10: 00010000 00010000 &quot;Bdata&quot;</span><br><span class="line">root@XiaoQiang:~# dd if=/dev/mtd0 of=/extdisks/sda1/0-all.bin</span><br><span class="line">32768+0 records in</span><br><span class="line">32768+0 records out</span><br><span class="line">root@XiaoQiang:~# dd if=/dev/mtd1 of=/extdisks/sda1/1-bootloader.bin</span><br><span class="line">384+0 records in</span><br><span class="line">384+0 records out</span><br><span class="line">root@XiaoQiang:~# dd if=/dev/mtd2 of=/extdisks/sda1/2-config.bin</span><br><span class="line">128+0 records in</span><br><span class="line">128+0 records out</span><br><span class="line">root@XiaoQiang:~# dd if=/dev/mtd3 of=/extdisks/sda1/3-Factory.bin</span><br><span class="line">128+0 records in</span><br><span class="line">128+0 records out</span><br><span class="line">root@XiaoQiang:~# dd if=/dev/mtd4 of=/extdisks/sda1/4-OS1.bin</span><br><span class="line">25600+0 records in</span><br><span class="line">25600+0 records out</span><br><span class="line">root@XiaoQiang:~# dd if=/dev/mtd5 of=/extdisks/sda1/5-rootfs.bin</span><br><span class="line">22716+1 records in</span><br><span class="line">22716+1 records out</span><br><span class="line">root@XiaoQiang:~# dd if=/dev/mtd6 of=/extdisks/sda1/6-OS2.bin</span><br><span class="line">4096+0 records in</span><br><span class="line">4096+0 records out</span><br><span class="line">root@XiaoQiang:~# dd if=/dev/mtd7 of=/extdisks/sda1/7-overlay.bin</span><br><span class="line">2048+0 records in</span><br><span class="line">2048+0 records out</span><br><span class="line">root@XiaoQiang:~# dd if=/dev/mtd8 of=/extdisks/sda1/8-crash.bin</span><br><span class="line">128+0 records in</span><br><span class="line">128+0 records out</span><br><span class="line">root@XiaoQiang:~# dd if=/dev/mtd9 of=/extdisks/sda1/9-reserved.bin</span><br><span class="line">128+0 records in</span><br><span class="line">128+0 records out</span><br><span class="line">root@XiaoQiang:~# dd if=/dev/mtd10 of=/extdisks/sda1/10-Bdata.bin</span><br><span class="line">128+0 records in</span><br><span class="line">128+0 records out</span><br><span class="line">root@XiaoQiang:~# </span><br></pre></td></tr></table></figure>

<h2 id="写入breed"><a href="#写入breed" class="headerlink" title="写入breed"></a>写入breed</h2><p>breed下载</p>
<p><a href="https://breed.hackpascal.net/breed-mt7620-xiaomi-mini.bin">https://breed.hackpascal.net/breed-mt7620-xiaomi-mini.bin</a></p>
<p>上传breed-mt7620-xiaomi-mini.bin文件并写入路由器。</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">scp breed-mt7620-xiaomi-mini.bin root@192.168.1.1:/tmp</span></span><br><span class="line">root@192.168.1.1&#x27;s password: </span><br><span class="line">breed-mt7620-xiaomi-mini.bin                                                                              100%   88KB 958.9KB/s   00:00    </span><br></pre></td></tr></table></figure>

<p>写入</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@XiaoQiang:~# mtd -r write /tmp/breed-mt7620-xiaomi-mini.bin Bootloader</span><br><span class="line">Unlocking Bootloader ...</span><br><span class="line"></span><br><span class="line">Writing from /tmp/breed-mt7620-xiaomi-mini.bin to Bootloader ...     </span><br><span class="line">Rebooting ...</span><br></pre></td></tr></table></figure>

<h2 id="openwrt官网固件下载"><a href="#openwrt官网固件下载" class="headerlink" title="openwrt官网固件下载"></a>openwrt官网固件下载</h2><p>小米路由器mini的页面 <a href="https://openwrt.org/toh/xiaomi/miwifi_mini">https://openwrt.org/toh/xiaomi/miwifi_mini</a></p>
<p>下载固件openwrt-22.03.3-ramips-mt7620-xiaomi_miwifi-mini-squashfs-sysupgrade.bin</p>
<h2 id="进入breed"><a href="#进入breed" class="headerlink" title="进入breed"></a>进入breed</h2><p>拔掉路由器的电源<br>按住 reset 按钮之后重新接入电源，指示灯变为闪烁状态即可松开 reset 键<br>有线连接路由器，在浏览器输入 192.168.1.1 进入 Breed 控制台</p>
<p><img src="https://raw.githubusercontent.com/aaray6/mygitnote_images/main/gitnote/2023/02/22/xiaomi_mini_2_breed-1677048511940.png" alt="title"></p>
<h2 id="备份原来的固件"><a href="#备份原来的固件" class="headerlink" title="备份原来的固件"></a>备份原来的固件</h2><p>点击“固件备份”，备份固件，以防以后想刷回去</p>
<p><img src="https://raw.githubusercontent.com/aaray6/mygitnote_images/main/gitnote/2023/02/22/xiaomi_mini_2_breed_backup-1677048556835.png" alt="title"></p>
<h2 id="刷入openwrt固件"><a href="#刷入openwrt固件" class="headerlink" title="刷入openwrt固件"></a>刷入openwrt固件</h2><p>点击“固件更新”，选中固件，文件选择我们准备工作中的openwrt固件，点击上传</p>
<p><img src="https://raw.githubusercontent.com/aaray6/mygitnote_images/main/gitnote/2023/02/22/xiaomi_mini_2_write-1677048714416.png" alt="title"></p>
<p>路由器会自动重启并进入openwrt。</p>
<h2 id="进入openwrt"><a href="#进入openwrt" class="headerlink" title="进入openwrt"></a>进入openwrt</h2><p>连接WAN网线到上级路由或光猫，连接LAN网线到电脑。浏览器打开<a href="http://192.168.1.1/">http://192.168.1.1</a></p>
<p>默认用户名密码root&#x2F;password</p>
<p>至此，恭喜你！openwrt刷入成功</p>
<h2 id="设置为中继桥和打印服务器"><a href="#设置为中继桥和打印服务器" class="headerlink" title="设置为中继桥和打印服务器"></a>设置为中继桥和打印服务器</h2><h3 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1. 中继 (https://openwrt.org/docs/guide-user/network/wifi/relay_configuration)</span><br><span class="line">relayd</span><br><span class="line">luci-proto-relay</span><br><span class="line"></span><br><span class="line">2. USB打印机 (https://openwrt.org/docs/guide-user/services/print_server/p910ndprinterserver)</span><br><span class="line">kmod-usb-printer</span><br><span class="line">p910nd</span><br><span class="line">luci-app-p910nd</span><br><span class="line">luci-i18n-p910nd-zh-cn</span><br><span class="line"></span><br><span class="line">3. 界面汉化</span><br><span class="line">luci-i18n-base-zh-cn</span><br><span class="line">luci-i18n-firewall-zh-cn</span><br><span class="line">luci-i18n-opkg-zh-cn</span><br></pre></td></tr></table></figure>

<p>命令行方式</p>
<p>ssh到路由器后台</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@192.168.1.1</span><br></pre></td></tr></table></figure>

<p>更新package</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">root@OpenWrt:~# opkg update</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/22.03.3/targets/ramips/mt7620/packages/Packages.gz</span><br><span class="line">Updated list of available packages in /var/opkg-lists/openwrt_core</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/22.03.3/targets/ramips/mt7620/packages/Packages.sig</span><br><span class="line">Signature check passed.</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/22.03.3/packages/mipsel_24kc/base/Packages.gz</span><br><span class="line">Updated list of available packages in /var/opkg-lists/openwrt_base</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/22.03.3/packages/mipsel_24kc/base/Packages.sig</span><br><span class="line">Signature check passed.</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/22.03.3/packages/mipsel_24kc/luci/Packages.gz</span><br><span class="line">Updated list of available packages in /var/opkg-lists/openwrt_luci</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/22.03.3/packages/mipsel_24kc/luci/Packages.sig</span><br><span class="line">Signature check passed.</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/22.03.3/packages/mipsel_24kc/packages/Packages.gz</span><br><span class="line">Updated list of available packages in /var/opkg-lists/openwrt_packages</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/22.03.3/packages/mipsel_24kc/packages/Packages.sig</span><br><span class="line">Signature check passed.</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/22.03.3/packages/mipsel_24kc/routing/Packages.gz</span><br><span class="line">Updated list of available packages in /var/opkg-lists/openwrt_routing</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/22.03.3/packages/mipsel_24kc/routing/Packages.sig</span><br><span class="line">Signature check passed.</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/22.03.3/packages/mipsel_24kc/telephony/Packages.gz</span><br><span class="line">Updated list of available packages in /var/opkg-lists/openwrt_telephony</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/22.03.3/packages/mipsel_24kc/telephony/Packages.sig</span><br><span class="line">Signature check passed.</span><br></pre></td></tr></table></figure>

<p>安装打印机相关模块</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">root@OpenWrt:~# opkg install kmod-usb-printer</span><br><span class="line">Installing kmod-usb-printer (5.10.161-1) to root...</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/22.03.3/targets/ramips/mt7620/packages/kmod-usb-printer_5.10.161-1_mipsel_24kc.ipk</span><br><span class="line">Configuring kmod-usb-printer.</span><br><span class="line">root@OpenWrt:~# opkg install p910nd</span><br><span class="line">Installing p910nd (0.97-9) to root...</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/22.03.3/packages/mipsel_24kc/packages/p910nd_0.97-9_mipsel_24kc.ipk</span><br><span class="line">Configuring p910nd.</span><br><span class="line">root@OpenWrt:~# opkg install luci-app-p910nd</span><br><span class="line">Installing luci-app-p910nd (git-20.108.38431-8f34e10) to root...</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/22.03.3/packages/mipsel_24kc/luci/luci-app-p910nd_git-20.108.38431-8f34e10_all.ipk</span><br><span class="line">Installing luci-compat (git-22.069.45071-03bb0e2) to root...</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/22.03.3/packages/mipsel_24kc/luci/luci-compat_git-22.069.45071-03bb0e2_all.ipk</span><br><span class="line">Configuring luci-compat.</span><br><span class="line">Configuring luci-app-p910nd.</span><br><span class="line">root@OpenWrt:~# opkg install luci-i18n-p910nd-zh-cn</span><br><span class="line">Installing luci-i18n-p910nd-zh-cn (git-22.339.56129-deebfa0) to root...</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/22.03.3/packages/mipsel_24kc/luci/luci-i18n-p910nd-zh-cn_git-22.339.56129-deebfa0_all.ipk</span><br><span class="line">Configuring luci-i18n-p910nd-zh-cn.</span><br><span class="line">root@OpenWrt:~# </span><br></pre></td></tr></table></figure>

<p>安装中继桥模块</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@OpenWrt:~# opkg install relayd</span><br><span class="line">Package relayd (2020-04-25-f4d759be-1) installed in root is up to date.</span><br><span class="line">root@OpenWrt:~# opkg install luci-proto-relay</span><br><span class="line">Installing luci-proto-relay (git-19.307.61018-284918b) to root...</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/22.03.3/packages/mipsel_24kc/luci/luci-proto-relay_git-19.307.61018-284918b_all.ipk</span><br><span class="line">Configuring luci-proto-relay.</span><br></pre></td></tr></table></figure>

<p>安装汉化模块</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@OpenWrt:~# opkg install luci-i18n-base-zh-cn</span><br><span class="line">Installing luci-i18n-base-zh-cn (git-23.021.35986-09d68fb) to root...</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/22.03.3/packages/mipsel_24kc/luci/luci-i18n-base-zh-cn_git-23.021.35986-09d68fb_all.ipk</span><br><span class="line">Configuring luci-i18n-base-zh-cn.</span><br><span class="line">root@OpenWrt:~# opkg install luci-i18n-firewall-zh-cn</span><br><span class="line">Installing luci-i18n-firewall-zh-cn (git-23.021.35986-09d68fb) to root...</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/22.03.3/packages/mipsel_24kc/luci/luci-i18n-firewall-zh-cn_git-23.021.35986-09d68fb_all.ipk</span><br><span class="line">Configuring luci-i18n-firewall-zh-cn.</span><br><span class="line">root@OpenWrt:~# opkg install luci-i18n-opkg-zh-cn</span><br><span class="line">Installing luci-i18n-opkg-zh-cn (git-23.021.35986-09d68fb) to root...</span><br><span class="line">Downloading https://downloads.openwrt.org/releases/22.03.3/packages/mipsel_24kc/luci/luci-i18n-opkg-zh-cn_git-23.021.35986-09d68fb_all.ipk</span><br><span class="line">Configuring luci-i18n-opkg-zh-cn.</span><br></pre></td></tr></table></figure>

<p>重启路由</p>
<h3 id="配置无线中继"><a href="#配置无线中继" class="headerlink" title="配置无线中继"></a>配置无线中继</h3><p>启动openwrt后，按照这个文章配置无线中继。<a href="https://openwrt.org/docs/guide-user/network/wifi/relay_configuration">https://openwrt.org/docs/guide-user/network/wifi/relay_configuration</a></p>
<ol>
<li>网络-接口-LAN-编辑 修改路由器为其他网段并关闭DHCP</li>
</ol>
<p>修改IP为192.168.7.1，另外，还要修改DNS，例如设置成192.168.1.1或者114.114.114.114</p>
<p><img src="https://raw.githubusercontent.com/aaray6/mygitnote_images/main/gitnote/2023/02/23/xiaomi_mini_3_openwrt_relay_1-1677114892474.png" alt="title"></p>
<p>关闭DHCP</p>
<p><img src="https://raw.githubusercontent.com/aaray6/mygitnote_images/main/gitnote/2023/02/23/xiaomi_mini_3_openwrt_relay_2-1677114971634.png" alt="title"></p>
<p><img src="https://raw.githubusercontent.com/aaray6/mygitnote_images/main/gitnote/2023/02/23/xiaomi_mini_3_openwrt_relay_3-1677114995555.png" alt="title"></p>
<ol start="2">
<li>网络-无线-扫描 加入上级无线网</li>
</ol>
<p><img src="https://raw.githubusercontent.com/aaray6/mygitnote_images/main/gitnote/2023/02/23/xiaomi_mini_3_openwrt_relay_4wifi-1677115052691.png" alt="title"></p>
<p>无线连接到上级WIFI</p>
<p><img src="https://raw.githubusercontent.com/aaray6/mygitnote_images/main/gitnote/2023/02/23/xiaomi_mini_3_openwrt_relay_5wifi-1677115105759.png" alt="title"></p>
<p>测试一下，看是否连接成功</p>
<p><img src="https://raw.githubusercontent.com/aaray6/mygitnote_images/main/gitnote/2023/02/23/xiaomi_mini_3_openwrt_relay_6test-1677115158167.png" alt="title"></p>
<ol start="3">
<li>网络-接口 设置刚添加的WWAN接口固定IP</li>
</ol>
<p>设置固定IP为192.168.1.101</p>
<ol start="4">
<li>网络-接口-添加 添加中继桥接口</li>
</ol>
<p><img src="https://raw.githubusercontent.com/aaray6/mygitnote_images/main/gitnote/2023/02/23/xiaomi_mini_3_openwrt_relay_8_repeater_bridge-1677115325787.png" alt="title"></p>
<p>设置IP为192.168.1.101,网络间中继选lan和wwan</p>
<p><img src="https://raw.githubusercontent.com/aaray6/mygitnote_images/main/gitnote/2023/02/23/xiaomi_mini_3_openwrt_relay_9_repeater_bridge-1677115478723.png" alt="title"></p>
<p>到这一步网络就设置好了。路由器是固定IP，连接此路由器的终端会被分配192.168.1.0&#x2F;24网段的IP。</p>
<h2 id="设置打印机服务"><a href="#设置打印机服务" class="headerlink" title="设置打印机服务"></a>设置打印机服务</h2><p>打印机连接路由器USB口。</p>
<p>打开路由器上的打印机服务，服务-p910nd打印服务器</p>
<p><img src="https://raw.githubusercontent.com/aaray6/mygitnote_images/main/gitnote/2023/02/23/xiaomi_mini_3_openwrt_10_printer-1677115716858.png" alt="title"></p>
<p>客户端例如Linux上的CUPS上用socket:&#x2F;&#x2F;192.168.1.101:9100连接打印机。</p>
<p><img src="https://raw.githubusercontent.com/aaray6/mygitnote_images/main/gitnote/2023/02/23/xiaomi_mini_3_openwrt_10_printer_cups-1677115910687.png" alt="title"></p>
<p>打印机驱动需要在客户端安装。</p>
</div></article><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2023/03/21/zerotier-notes/"><i class="fa fa-chevron-left">  </i><span>zerotier笔记</span></a></div><div class="next-post pull-right"><a href="/2023/02/14/gitnote/"><span>gitnote</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2025 By Ray Qu</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>