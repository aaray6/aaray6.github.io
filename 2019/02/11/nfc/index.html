<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="NFC笔记"><meta name="keywords" content=""><meta name="author" content="Ray Qu"><meta name="copyright" content="Ray Qu"><title>NFC笔记 | My Notes</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 7.3.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Ubuntu-Linux%E4%B8%8B%E7%94%A8NFC-reader%E7%A0%B4%E8%A7%A3%E5%A4%8D%E5%88%B6M1%E5%8D%A1"><span class="toc-number">1.</span> <span class="toc-text">Ubuntu Linux下用NFC reader破解复制M1卡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#libnfc%E5%AE%89%E8%A3%85%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">1.1.</span> <span class="toc-text">libnfc安装遇到的问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85mfoc"><span class="toc-number">1.2.</span> <span class="toc-text">安装mfoc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-libnfc-examples"><span class="toc-number">1.3.</span> <span class="toc-text">安装 libnfc-examples</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nfc-cloner%E8%84%9A%E6%9C%AC"><span class="toc-number">1.4.</span> <span class="toc-text">nfc-cloner脚本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%84%E7%A7%8DUID%E5%8D%A1"><span class="toc-number">2.</span> <span class="toc-text">各种UID卡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#libnfc%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7"><span class="toc-number">3.</span> <span class="toc-text">libnfc相关工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%88%E5%B9%B6%E5%8D%A1"><span class="toc-number">4.</span> <span class="toc-text">合并卡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux%E4%B8%8B%E5%BE%80%E7%A9%BA%E7%99%BD%E5%8D%A1%E5%86%99dump%E6%96%87%E4%BB%B6"><span class="toc-number">5.</span> <span class="toc-text">Linux下往空白卡写dump文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%BC%E5%BC%8F%E5%8C%96%EF%BC%88%E5%A6%82%E6%9E%9C%E5%8D%A1%E4%B8%8D%E6%98%AF%E7%A9%BA%E7%99%BD%E5%8D%A1%EF%BC%8C%E9%9C%80%E8%A6%81%E6%A0%BC%E5%BC%8F%E5%8C%96%EF%BC%89"><span class="toc-number">5.1.</span> <span class="toc-text">格式化（如果卡不是空白卡，需要格式化）</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Ray Qu</div><div class="author-info__description text-center">My Tech Notes and Other stuff</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">77</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">My Notes</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/bookmarks">Bookmarks</a><a class="site-page" href="/about.html">About</a><a class="site-page" href="/contact.html">Contact</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">NFC笔记</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-02-11</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>在淘宝上买了一个IC卡复制工具</p>
<p><img src="/myimages/nfc_01_reader.png" alt="小黑NFC读卡器"></p>
<p><img src="/myimages/nfc_01_reader2.png" alt="小黑NFC读卡器"></p>
<p>带了Windows版的软件和驱动</p>
<p>2020-05-28更新，最开始的软件有序列号，过期了。厂家更新了一个新的不需要序列号的软件。</p>
<p>下载<a href="https://pan.baidu.com/s/13G_Sgu1j_h_LzgJXgDvJwg">NFC小黑3.0(1909)链接: https://pan.baidu.com/s/13G_Sgu1j_h_LzgJXgDvJwg</a>  密码: eqc0</p>
<p><img src="/myimages/nfc_02_windowssoftware.png" alt="软件"></p>
<p>带的软件里有libnfc.dll, mfoc.dll两个文件。驱动程序就是一个”Prolific Technology, Inc. PL2303 Serial Port“ USB转串口驱动。读卡器是USB接口的，安装驱动之后映射岛了COM3。<br>因此想到是否可以找到其他的软件使用这个读卡器。</p>
<p>以下记录Linux(ubuntu)下找到的方法</p>
<h2 id="Ubuntu-Linux下用NFC-reader破解复制M1卡"><a href="#Ubuntu-Linux下用NFC-reader破解复制M1卡" class="headerlink" title="Ubuntu Linux下用NFC reader破解复制M1卡"></a>Ubuntu Linux下用NFC reader破解复制M1卡</h2><p>linux自带了PL2303驱动，插上读卡器后用lsusb命令可以看到<br>”Bus 001 Device 018: ID 067b:2303 Prolific Technology, Inc. PL2303 Serial Port“</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">lsusb</span></span><br><span class="line">Bus 002 Device 003: ID 046d:c534 Logitech, Inc. Unifying Receiver</span><br><span class="line">Bus 002 Device 002: ID 8087:0020 Intel Corp. Integrated Rate Matching Hub</span><br><span class="line">Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</span><br><span class="line">Bus 001 Device 005: ID 17ef:4816 Lenovo Integrated Webcam</span><br><span class="line">Bus 001 Device 004: ID 0a5c:217f Broadcom Corp. BCM2045B (BDC-2.1)</span><br><span class="line">Bus 001 Device 003: ID 147e:2016 Upek Biometric Touchchip/Touchstrip Fingerprint Sensor</span><br><span class="line">Bus 001 Device 018: ID 067b:2303 Prolific Technology, Inc. PL2303 Serial Port</span><br><span class="line">Bus 001 Device 002: ID 8087:0020 Intel Corp. Integrated Rate Matching Hub</span><br><span class="line">Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>安装了libnfc之后，可以用以下命令看到读卡器已经可以找到，注意，必须用root权限，否则会有以下结果</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">nfc-list</span><br><span class="line">nfc-list uses libnfc 1.7.1</span><br><span class="line">error</span><br><span class="line">libnfc.driver.pn532_uart</span><br><span class="line">Invalid serial port: /dev/ttyUSB0</span><br><span class="line">nfc-list: ERROR: Unable to open NFC device: pn532_uart:/dev/ttyUSB0</span><br></pre></td></tr></table></figure>

<p>用root权限则是以下结果</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo nfc-list</span><br><span class="line">[sudo] quxr 的密码： </span><br><span class="line">nfc-list uses libnfc 1.7.1</span><br><span class="line">NFC device: pn532_uart:/dev/ttyUSB0 opened</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="libnfc安装遇到的问题"><a href="#libnfc安装遇到的问题" class="headerlink" title="libnfc安装遇到的问题"></a>libnfc安装遇到的问题</h3><ul>
<li>&#x2F;etc&#x2F;nfc&#x2F;libnfc.conf<br>需要把最后两行注释去掉</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">device.name = &quot;microBuilder.eu&quot;</span><br><span class="line">device.connstring = &quot;pn532_uart:/dev/ttyUSB0&quot;</span><br></pre></td></tr></table></figure>

<p>如果系统没安装libnfc，可以用一下命令安装</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install libnfc-bin</span><br></pre></td></tr></table></figure>

<p>另外，需要安装libnfc-dev包，因为一会编译mfoc需要用到，mfoc在apt里找不到安装包，需要自己编译</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install libnfc-dev</span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/nfc-tools/libnfc">libnfc</a></p>
<h3 id="安装mfoc"><a href="#安装mfoc" class="headerlink" title="安装mfoc"></a>安装mfoc</h3><p><a href="https://github.com/nfc-tools/mfoc">mfoc</a></p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ~/work/nfc/nfc-tools/</span><br><span class="line">cd ~/work/nfc/nfc-tools/</span><br><span class="line">git clone https://github.com/nfc-tools/mfoc</span><br><span class="line">cd mfoc</span><br><span class="line">autoreconf -is</span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; sudo make install</span><br></pre></td></tr></table></figure>

<h3 id="安装-libnfc-examples"><a href="#安装-libnfc-examples" class="headerlink" title="安装 libnfc-examples"></a>安装 libnfc-examples</h3><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install libnfc-examples</span><br></pre></td></tr></table></figure>

<h3 id="nfc-cloner脚本"><a href="#nfc-cloner脚本" class="headerlink" title="nfc-cloner脚本"></a>nfc-cloner脚本</h3><p><a href="https://www.youtube.com/watch?v=c0Qsmgvj_oo">nfc-cloner视频教程(youtube)</a></p>
<p>以下脚本需要用root权限运行</p>
<p><a href="https://www.lostserver.com/static/nfc-cloner.sh">nfc-cloner.sh脚本</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#set -x</span></span><br><span class="line"><span class="comment">#------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Keld Norman, Dubex A/S, Sep, 2018 - CLONE ID CARD POC</span></span><br><span class="line"><span class="comment">#------------------------------------------------------</span></span><br><span class="line"><span class="comment"># NFC Card reader/writer used for this POC: </span></span><br><span class="line"><span class="comment"># Type: ACR122U-A9 </span></span><br><span class="line"><span class="comment"># Product: ACR122U PICC Interface</span></span><br><span class="line"><span class="comment"># Manufacturer: Advanced Cardsystems Ltd. (ACS)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># idVendor=072f, idProduct=2200, bcdDevice= 2.07</span></span><br><span class="line"><span class="comment"># device strings: Mfr=1, Product=2, SerialNumber=0</span></span><br><span class="line"><span class="comment"># Website: www.asc.com.hk </span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Some good commands to know about: </span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># READ UID FROM CARD:  sudo nfc-anticol</span></span><br><span class="line"><span class="comment"># WRITE UID TO CARD:   sudo nfc-mfsetuid 1234ACD</span></span><br><span class="line"><span class="comment"># CLEAN (FORMAT) CARD: sudo nfc-mfsetuid -f</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment">#------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Banner for the 1337&#x27;ish ness</span></span><br><span class="line"><span class="comment">#------------------------------------------------------</span></span><br><span class="line">clear</span><br><span class="line"><span class="built_in">cat</span> &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">   _____</span></span><br><span class="line"><span class="string">  |A .  | _____</span></span><br><span class="line"><span class="string">  | /.\ ||A ^  | _____</span></span><br><span class="line"><span class="string">  |(_._)|| / \ ||A _  | _____</span></span><br><span class="line"><span class="string">  |  |  || \ / || ( ) ||A_ _ |</span></span><br><span class="line"><span class="string">  |____V||  .  ||(_&#x27;_)||( v )|</span></span><br><span class="line"><span class="string">         |____V||  |  || \ / |</span></span><br><span class="line"><span class="string">                |____V||  .  |</span></span><br><span class="line"><span class="string">                       |____V|</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> Dubex Redteam Card Cloner utility</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="comment">#----------------------------------------</span></span><br><span class="line"><span class="comment"># VARIABLES</span></span><br><span class="line"><span class="comment">#----------------------------------------</span></span><br><span class="line">SAVE_CARD_DUMP_FILES_HERE=<span class="string">&quot;./card_data&quot;</span></span><br><span class="line">WRITE_SIDE=<span class="string">&quot;A&quot;</span> <span class="comment"># Can be A or B </span></span><br><span class="line"><span class="comment">#----------------------------------------</span></span><br><span class="line"><span class="comment"># PRE: </span></span><br><span class="line"><span class="comment">#----------------------------------------</span></span><br><span class="line"><span class="keyword">if</span> [ $(/usr/bin/id -u) -ne 0 ]; <span class="keyword">then</span> </span><br><span class="line"> <span class="built_in">printf</span> <span class="string">&quot; ### ERROR - You must run this script with sudo or as the user root!\n\n&quot;</span></span><br><span class="line"> <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="subst">$(/bin/uname --kernel-release)</span>&quot;</span> != <span class="string">&quot;4.18.3&quot;</span> ]; <span class="keyword">then</span> </span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot; ### INFO - The Linux kernel must be this version or higher: Linux edge 4.18.3&quot;</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;            Otherwise the native NFC card reader will crash (see it with the command dmesg)&quot;</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="keyword">if</span> [ ! -d <span class="variable">$&#123;SAVE_CARD_DUMP_FILES_HERE&#125;</span> ]; <span class="keyword">then</span> </span><br><span class="line"> <span class="built_in">mkdir</span> -p -m 0700 <span class="variable">$&#123;SAVE_CARD_DUMP_FILES_HERE&#125;</span> &gt;/dev/null 2&gt;&amp;1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">PROGRAM=<span class="string">&quot;<span class="subst">$(/usr/bin/basename $&#123;0&#125;)</span>&quot;</span></span><br><span class="line">MFOC=<span class="string">&quot;/usr/local/bin/mfoc&quot;</span>           <span class="comment"># apt-get install mfoc</span></span><br><span class="line">ANTICOL=<span class="string">&quot;/usr/bin/nfc-anticol&quot;</span>       <span class="comment"># apt-get install libnfc-examples</span></span><br><span class="line">NFC_POLL=<span class="string">&quot;/usr/bin/nfc-poll&quot;</span>         <span class="comment"># apt-get install libnfc-examples</span></span><br><span class="line">NFC_SETUID=<span class="string">&quot;/usr/bin/nfc-mfsetuid&quot;</span>   <span class="comment"># apt-get install libnfc-examples</span></span><br><span class="line">NFC_LIST=<span class="string">&quot;/usr/bin/nfc-list&quot;</span>         <span class="comment"># apt-get install libnfc-bin</span></span><br><span class="line">NFC_CLASSIC=<span class="string">&quot;/usr/bin/nfc-mfclassic&quot;</span> <span class="comment"># apt-get install libnfc-bin</span></span><br><span class="line">TIMESTAMP=<span class="string">&quot;<span class="subst">$(date &#x27;+%Y_%m_%d_%H%M%S&#x27;)</span>&quot;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">for</span> UTIL <span class="keyword">in</span> <span class="variable">$&#123;MFOC&#125;</span> <span class="variable">$&#123;ANTICOL&#125;</span> <span class="variable">$&#123;NFC_LIST&#125;</span> <span class="variable">$&#123;NFC_POLL&#125;</span> <span class="variable">$&#123;NFC_SETUID&#125;</span> <span class="variable">$&#123;NFC_CLASSIC&#125;</span>; <span class="keyword">do</span> </span><br><span class="line"> <span class="keyword">if</span> [ ! -x <span class="variable">$&#123;UTIL&#125;</span> ];<span class="keyword">then</span> </span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot; ### ERROR - Utility <span class="variable">$&#123;UTIL&#125;</span> not found!&quot;</span></span><br><span class="line"> <span class="built_in">printf</span> <span class="string">&quot;\n Help to installing the missing utilities:\n</span></span><br><span class="line"><span class="string"> /usr/local/bin/mfoc    # apt-get install mfoc</span></span><br><span class="line"><span class="string"> /usr/bin/nfc-mfclassic # apt-get install libnfc-bin</span></span><br><span class="line"><span class="string"> /usr/bin/nfc-list      # apt-get install libnfc-bin</span></span><br><span class="line"><span class="string"> /usr/bin/nfc-anticol   # apt-get install libnfc-examples</span></span><br><span class="line"><span class="string"> /usr/bin/nfc-mfssetuid # apt-get install libnfc-examples</span></span><br><span class="line"><span class="string"> /usr/bin/nfc-poll      # apt-get install libnfc-examples\n\n&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"> <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#----------------------------------------</span></span><br><span class="line"><span class="comment"># FUNCTIONS</span></span><br><span class="line"><span class="comment">#----------------------------------------</span></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">detect_card_reader</span></span>() &#123;</span><br><span class="line"> CARD_READER_FOUND=0</span><br><span class="line"> <span class="keyword">while</span> [ <span class="variable">$&#123;CARD_READER_FOUND&#125;</span> -eq 0 ]; <span class="keyword">do</span></span><br><span class="line">  READER_DATA=<span class="string">&quot;<span class="subst">$($&#123;NFC_LIST&#125; 2&gt;&amp;1)</span>&quot;</span></span><br><span class="line">  CARD_READER_FOUND=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;READER_DATA&#125;</span>&quot;</span>|grep -c -E <span class="string">&quot;^NFC device:.*opened$&quot;</span>)</span><br><span class="line"> <span class="built_in">sleep</span> 1</span><br><span class="line"> <span class="keyword">done</span></span><br><span class="line"> <span class="built_in">return</span> 0</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#----------------------------------------</span></span><br><span class="line"><span class="comment"># MAIN</span></span><br><span class="line"><span class="comment">#----------------------------------------</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot; %-55s&quot;</span> <span class="string">&quot;Detecting card reader..&quot;</span></span><br><span class="line">detect_card_reader</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[OK]&quot;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">READ_CARD_LOOP=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$&#123;READ_CARD_LOOP&#125;</span> -eq 1 ]; <span class="keyword">do</span></span><br><span class="line"> <span class="built_in">printf</span> <span class="string">&quot; %-55s&quot;</span> <span class="string">&quot;Place the card to clone on the reader now..&quot;</span></span><br><span class="line"> read_uid_success=<span class="string">&quot;FALSE&quot;</span></span><br><span class="line"> <span class="keyword">while</span> [ <span class="string">&quot;<span class="variable">$&#123;read_uid_success&#125;</span>&quot;</span> == <span class="string">&quot;FALSE&quot;</span> ]; <span class="keyword">do</span> </span><br><span class="line">  DATA=<span class="string">&quot;<span class="subst">$($&#123;ANTICOL&#125; 2&gt;&amp;1)</span>&quot;</span></span><br><span class="line">  FAILED=$(<span class="built_in">echo</span> <span class="variable">$&#123;DATA&#125;</span>|grep -c <span class="string">&quot;Error: No tag available&quot;</span>)</span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$&#123;FAILED&#125;</span> -eq 0 ]; <span class="keyword">then</span> </span><br><span class="line">   CARD_UID=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;DATA&#125;</span>&quot;</span>|grep <span class="string">&quot;UID:&quot;</span>|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">   CARD_ATQA=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;DATA&#125;</span>&quot;</span>|grep <span class="string">&quot;ATQA:&quot;</span>|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">   CARD_SAK=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;DATA&#125;</span>&quot;</span>|grep <span class="string">&quot;SAK:&quot;</span>|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">   <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$&#123;CARD_UID&#125;</span>&quot;</span> == <span class="string">&quot;&quot;</span> -o <span class="string">&quot;<span class="variable">$&#123;CARD_ATQA&#125;</span>&quot;</span> == <span class="string">&quot;&quot;</span> -o <span class="string">&quot;<span class="variable">$&#123;CARD_SAK&#125;</span>&quot;</span> == <span class="string">&quot;&quot;</span> ]; <span class="keyword">then</span> </span><br><span class="line">    <span class="built_in">sleep</span> .5</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">    read_uid_success=<span class="string">&quot;SUCCESS&quot;</span></span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"> <span class="keyword">done</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;[OK]&quot;</span></span><br><span class="line"> <span class="comment">#</span></span><br><span class="line"> <span class="built_in">printf</span> <span class="string">&quot;\n ##### CARD DATA DUPLICATION IN PROGRESS ##### (this often takes up to 75 seconds)&quot;</span></span><br><span class="line"> <span class="built_in">printf</span> <span class="string">&quot;\n %-55s&quot;</span> <span class="string">&quot;<span class="subst">$(date)</span> Started  cloning of ID-Card with UID: <span class="variable">$&#123;CARD_UID&#125;</span> (ATQA:<span class="variable">$&#123;CARD_ATQA&#125;</span>/SAK:<span class="variable">$&#123;CARD_SAK&#125;</span>) &quot;</span></span><br><span class="line"> <span class="variable">$&#123;MFOC&#125;</span> -O <span class="variable">$&#123;SAVE_CARD_DUMP_FILES_HERE:-.&#125;</span>/<span class="variable">$&#123;CARD_UID&#125;</span>.<span class="variable">$&#123;TIMESTAMP&#125;</span>.mfd &gt; <span class="variable">$&#123;PROGRAM&#125;</span>.<span class="built_in">log</span> 2&gt;<span class="variable">$&#123;PROGRAM&#125;</span>.error</span><br><span class="line"> <span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span> </span><br><span class="line">  <span class="built_in">printf</span> <span class="string">&quot;\n ##### CARD DATA DUPLICATION FAILED !!!! #####\n\n&quot;</span></span><br><span class="line">  READ_CARD_LOOP=1</span><br><span class="line"> <span class="keyword">else</span> </span><br><span class="line">  READ_CARD_LOOP=0</span><br><span class="line">  <span class="built_in">printf</span> <span class="string">&quot;\n %-55s&quot;</span> <span class="string">&quot;<span class="subst">$(date)</span> Finished cloning of ID-Card with UID: <span class="variable">$&#123;CARD_UID&#125;</span> (ATQA:<span class="variable">$&#123;CARD_ATQA&#125;</span>/SAK:<span class="variable">$&#123;CARD_SAK&#125;</span>) &quot;</span></span><br><span class="line"> <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span> <span class="comment"># LOOP IF READ FAILED</span></span><br><span class="line"><span class="comment">#-------------------------------------------------</span></span><br><span class="line"><span class="comment"># WAIT FOR REPLACED CARD</span></span><br><span class="line"><span class="comment">#-------------------------------------------------</span></span><br><span class="line"><span class="built_in">sleep</span> .5</span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;\n\n %-55s&quot;</span> <span class="string">&quot;Remove the original card.. &quot;</span></span><br><span class="line">CARD_REMOVED=0</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$&#123;CARD_REMOVED&#125;</span> -eq 0 ]; <span class="keyword">do</span></span><br><span class="line"> <span class="variable">$&#123;NFC_POLL&#125;</span> &gt; /dev/null 2&gt;&amp;1</span><br><span class="line"> <span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span> </span><br><span class="line">  CARD_REMOVED=1</span><br><span class="line"> <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[OK]&quot;</span></span><br><span class="line"><span class="comment">#-------------------------------------------------</span></span><br><span class="line"><span class="comment"># WAIT FOR REPLACED CARD</span></span><br><span class="line"><span class="comment">#-------------------------------------------------</span></span><br><span class="line">ALLOW_OVERWRITE=0</span><br><span class="line">NEW_UID=<span class="string">&quot;<span class="variable">$&#123;UID&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$&#123;ALLOW_OVERWRITE&#125;</span> -eq 0 ]; <span class="keyword">do</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot; %-55s&quot;</span> <span class="string">&quot;Place a new blank card on the NFC Writer..&quot;</span></span><br><span class="line"> read_new_uid_success=<span class="string">&quot;FALSE&quot;</span></span><br><span class="line"> <span class="keyword">while</span> [ <span class="string">&quot;<span class="variable">$&#123;read_new_uid_success&#125;</span>&quot;</span> == <span class="string">&quot;FALSE&quot;</span> ]; <span class="keyword">do</span> </span><br><span class="line">  NEW_DATA=<span class="string">&quot;<span class="subst">$($&#123;ANTICOL&#125; 2&gt;&amp;1)</span>&quot;</span></span><br><span class="line">  NEW_FAILED=$(<span class="built_in">echo</span> <span class="variable">$&#123;NEW_DATA&#125;</span>|grep -c <span class="string">&quot;Error: No tag available&quot;</span>)</span><br><span class="line">  <span class="keyword">if</span> [ <span class="variable">$&#123;NEW_FAILED&#125;</span> -eq 0 ]; <span class="keyword">then</span> </span><br><span class="line">   NEW_CARD_UID=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;NEW_DATA&#125;</span>&quot;</span>|grep <span class="string">&quot;UID:&quot;</span>|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">   NEW_CARD_ATQA=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;NEW_DATA&#125;</span>&quot;</span>|grep <span class="string">&quot;ATQA:&quot;</span>|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">   NEW_CARD_SAK=$(<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;NEW_DATA&#125;</span>&quot;</span>|grep <span class="string">&quot;SAK:&quot;</span>|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>)</span><br><span class="line">   <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$&#123;NEW_CARD_UID&#125;</span>&quot;</span> == <span class="string">&quot;&quot;</span> -o <span class="string">&quot;<span class="variable">$&#123;NEW_CARD_ATQA&#125;</span>&quot;</span> == <span class="string">&quot;&quot;</span> -o <span class="string">&quot;<span class="variable">$&#123;NEW_CARD_SAK&#125;</span>&quot;</span> == <span class="string">&quot;&quot;</span> ]; <span class="keyword">then</span> </span><br><span class="line">    <span class="built_in">sleep</span> .5</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">    read_new_uid_success=<span class="string">&quot;SUCCESS&quot;</span></span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"> <span class="keyword">done</span></span><br><span class="line"> <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$&#123;CARD_UID&#125;</span>&quot;</span> == <span class="string">&quot;<span class="variable">$&#123;NEW_CARD_UID&#125;</span>&quot;</span> ]; <span class="keyword">then</span> </span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;[WARNING]&quot;</span></span><br><span class="line">  <span class="built_in">printf</span> <span class="string">&quot;\n ### WARNING - The new card has the same UID as the old card!\n\n&quot;</span></span><br><span class="line">  <span class="built_in">read</span> -r -p <span class="string">&quot; QUESTION: Do You want to overwrite this card (y/n)? &quot;</span> response</span><br><span class="line">  <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$response</span>&quot;</span> =~ ^([yY][eE][sS]|[yY])+$ ]]</span><br><span class="line">   <span class="keyword">then</span></span><br><span class="line">    ALLOW_OVERWRITE=1</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">   ALLOW_OVERWRITE=0</span><br><span class="line">   <span class="built_in">sleep</span> .5</span><br><span class="line">   <span class="built_in">printf</span> <span class="string">&quot;\n %-55s&quot;</span> <span class="string">&quot;Remove the original card.. &quot;</span></span><br><span class="line">   CARD_REMOVED=0</span><br><span class="line">   <span class="keyword">while</span> [ <span class="variable">$&#123;CARD_REMOVED&#125;</span> -eq 0 ]; <span class="keyword">do</span></span><br><span class="line">    <span class="variable">$&#123;NFC_POLL&#125;</span> &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">    <span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span> </span><br><span class="line">     CARD_REMOVED=1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">   <span class="keyword">done</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">&quot;[OK]&quot;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"> <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;[OK]&quot;</span></span><br><span class="line">  ALLOW_OVERWRITE=1</span><br><span class="line"> <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="comment">#----------------------------------------</span></span><br><span class="line"><span class="comment">#  WRITE THE CLONED CARD</span></span><br><span class="line"><span class="comment">#----------------------------------------</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;\n %-55s&quot;</span> <span class="string">&quot;Writing UID: <span class="variable">$&#123;CARD_UID&#125;</span> on the new card &quot;</span></span><br><span class="line"><span class="variable">$&#123;NFC_SETUID&#125;</span> <span class="variable">$&#123;CARD_UID&#125;</span> &gt;&gt; <span class="variable">$&#123;PROGRAM&#125;</span>.<span class="built_in">log</span> 2&gt;<span class="variable">$&#123;PROGRAM&#125;</span>.error</span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span> </span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;[ERROR]&quot;</span></span><br><span class="line"> <span class="built_in">printf</span> <span class="string">&quot;\n ### ERROR - An error occoured writing UID on the new card!&quot;</span></span><br><span class="line"> <span class="built_in">printf</span> <span class="string">&quot;\n             You need special cards to write to sector 0 (it is normally readonly)\n\n&quot;</span></span><br><span class="line"> <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"> <span class="built_in">echo</span> <span class="string">&quot;[OK]&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot; %-55s\n\n&quot;</span> <span class="string">&quot;Writing (<span class="variable">$&#123;WRITE_SIDE&#125;</span> side) data from original card:&quot;</span></span><br><span class="line"><span class="variable">$&#123;NFC_CLASSIC&#125;</span> w <span class="variable">$&#123;WRITE_SIDE&#125;</span> <span class="variable">$&#123;SAVE_CARD_DUMP_FILES_HERE:-.&#125;</span>/<span class="variable">$&#123;CARD_UID&#125;</span>.<span class="variable">$&#123;TIMESTAMP&#125;</span>.mfd | <span class="built_in">tee</span> -a <span class="variable">$&#123;PROGRAM&#125;</span>.<span class="built_in">log</span> 2&gt;<span class="variable">$&#123;PROGRAM&#125;</span>.error</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment">#----------------------------------------</span></span><br><span class="line"><span class="comment"># END OF SCRIPT</span></span><br><span class="line"><span class="comment">#----------------------------------------</span></span><br></pre></td></tr></table></figure>

<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ./nfc-cloner.sh</span><br></pre></td></tr></table></figure>

<h2 id="各种UID卡"><a href="#各种UID卡" class="headerlink" title="各种UID卡"></a>各种UID卡</h2><p>M1 卡<br>普通IC卡，0扇区不可以修改，其他扇区可反复擦写，我们使用的电梯卡、门禁卡等智能卡发卡商所使用的都是 M1 卡，可以理解为物业发的原卡。</p>
<p>UID 卡<br>普通复制卡，可以重复擦写所有扇区，主要应用在IC卡复制上，遇到带有防火墙的读卡器就会失效。</p>
<p>CUID 卡<br>可擦写防屏蔽卡，可以重复擦写所有扇区，UID卡复制无效的情况下使用，可以绕过防火墙。</p>
<p>FUID 卡<br>不可擦写防屏蔽卡，此卡的特点0扇区只能写入一次，写入一次变成 M1 卡，CUID 复制没用的情况下使用，可以绕过防火墙。</p>
<p>UFUID 卡<br>高级复制卡，我们就理解为是 UID 和 FUID 的合成卡，需要封卡操作，不封卡就是 UID 卡，封卡后就变为 M1 卡。</p>
<p>经测试,我用的读卡器配合libnfc相关工具，可以复制UID,CUID卡，其他卡没测试</p>
<h2 id="libnfc相关工具"><a href="#libnfc相关工具" class="headerlink" title="libnfc相关工具"></a>libnfc相关工具</h2><p>对于写过一次的UID卡，再次写入会遇到以下异常</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Writing 64 blocks |nfc_initiator_transceive_bytes: Mifare Authentication Error</span><br><span class="line">nfc_initiator_transceive_bytes: Mifare Authentication Error</span><br><span class="line">nfc_initiator_transceive_bytes: Mifare Authentication Error</span><br><span class="line">nfc_initiator_transceive_bytes: Mifare Authentication Error</span><br><span class="line">nfc_initiator_transceive_bytes: Mifare Authentication Error</span><br><span class="line">nfc_initiator_transceive_bytes: Mifare Authentication Error</span><br><span class="line">nfc_initiator_transceive_bytes: Mifare Authentication Error</span><br><span class="line">nfc_initiator_transceive_bytes: Mifare Authentication Error</span><br><span class="line">nfc_initiator_transceive_bytes: Mifare Authentication Error</span><br></pre></td></tr></table></figure>

<p>这是因为空白卡用的KEY都是00000000,FFFFFFFFFFFF,复制过之后KEY就不是默认的了</p>
<p>其中一个最简单的解决办法是重新格式化成空白卡</p>
<p>先用mfoc破解得到dump文件<br>sudo mfoc -O dump<br>再用mifare-classic-format命令和dump文件把卡格式化成空白卡<br>sudo mifare-classic-format dump</p>
<p>注1:mifare-classic-format可以通过以下命令安装<br>sudo apt install libfreefare-bin</p>
<p>注2:如果你已经知道卡的KEY，可以在mfoc命令里加上-f KnownKeys.txt参数</p>
<p>KnownKeys.txt文件格式如下</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">B8527F9427A4</span><br><span class="line">013940233313</span><br></pre></td></tr></table></figure>

<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mfoc -f KnownKeys.txt -O dump</span><br><span class="line">sudo mifare-classic-format dump</span><br></pre></td></tr></table></figure>

<h2 id="合并卡"><a href="#合并卡" class="headerlink" title="合并卡"></a>合并卡</h2><p>我有两个卡，一个门禁一个电梯。门禁系统只用到了最后4个扇区，而且还没用到卡ID。另外一个电梯系统恰巧没用到最后4个扇区。</p>
<p>所以我把门禁dump文件最后4个扇区的内容替换到电梯dump文件最后4个扇区。把新dump文件写到卡里就得到了一个合并的卡。</p>
<p>注意: dump文件是1024字节的16进制文件。Windows下编辑可以用HxD编辑器。Linux下可以用bless编辑器。Windows下的notepad++加hexeditor插件打开dump文件显示内容可能是编码有问题。Linux下vi配合:%!xxd也有同样问题。但是用xxd命令直接显示dump文件则正确。</p>
<p>2023.2更新。<br>M1卡一共16扇区(0-15),每个扇区64字节(16字节×4行)<br>电梯卡用前9个扇区(0-8)<br>门卡用后6个扇区(10-15)<br>9号扇区没人用。两个卡都一样。</p>
<ol>
<li>取1前10个扇区<br>dd if&#x3D;lvzhou.dump of&#x3D;lvzhou_1.bin bs&#x3D;64 count&#x3D;10</li>
<li>取2后6个扇区<br>dd if&#x3D;meigui.dump of&#x3D;meigui_2.bin bs&#x3D;64 count&#x3D;6 skip&#x3D;10</li>
<li>合并文件<br>cat lvzhou_1.bin meigui_2.bin &gt; lvzhou10_meigui6.dump</li>
</ol>
<h2 id="Linux下往空白卡写dump文件"><a href="#Linux下往空白卡写dump文件" class="headerlink" title="Linux下往空白卡写dump文件"></a>Linux下往空白卡写dump文件</h2><h3 id="格式化（如果卡不是空白卡，需要格式化）"><a href="#格式化（如果卡不是空白卡，需要格式化）" class="headerlink" title="格式化（如果卡不是空白卡，需要格式化）"></a>格式化（如果卡不是空白卡，需要格式化）</h3><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nfc-mfsetuid -f</span><br></pre></td></tr></table></figure>

<p>or</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nfc-mfclassic f A blank-chinese.dmp keyfile.mfd f</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a href="https://gist.github.com/alphazo/3303282">Clone MiFare cards using chinesse UUID writable cards</a></p>
</blockquote>
<ul>
<li>Dump the blank chinese card card to get the keys</li>
</ul>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mfoc -f KnownKeys.txt -O blank-chinese.dmp</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Dump the Mifare card your want to copy</li>
</ul>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">mfoc -f KnownKeys.txt -O cardtocopy.dmp</span></span><br></pre></td></tr></table></figure>

<ul>
<li>普通UID卡，可以直接复制64块(block),包括卡号和厂商信息</li>
</ul>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nfc-mfclassic W b cardtocopy.dmp blank-chinese.dmp f</span></span><br><span class="line">or</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nfc-mfclassic W a cardtocopy.dmp blank-chinese.dmp f</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>CUID卡，需要分两步，先写63块，再写卡号</p>
</li>
<li><p>1- 复制63块</p>
</li>
</ul>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nfc-mfclassic w b cardtocopy.dmp blank-chinese.dmp f</span></span><br><span class="line">or</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nfc-mfclassic w a cardtocopy.dmp blank-chinese.dmp f</span></span><br></pre></td></tr></table></figure>

<ul>
<li>2- 复制卡号</li>
</ul>
<p>Get the “to-be-copied” card UID</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nfc-anticol|grep UID|awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span></span></span><br><span class="line">01234567</span><br></pre></td></tr></table></figure>

<p>Write UID into the card</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nfc-mfsetuid 01234567</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>The W option allows writing of special MIFARE cards that can be ‘unlocked’ to allow  block 0 to be overwritten. This includes UID and manufacturer data. Take care when amending UIDs to set the correct BCC (UID checksum). Currently only 4 byte UIDs are supported.<br>If use “w”, the block 0 will not be overwritten. Need to do extra step to set the UID.<br>f      Force using the keyfile KEYS even if UID does not match (optional).</p>
</blockquote>
<p>如果用W复制CUID卡，会出现以下提示</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nfc-mfclassic W b tobecopied.dmp blank-chinese.dmp f</span></span><br><span class="line">NFC reader: pn532_uart:/dev/ttyUSB0 opened</span><br><span class="line">Expected MIFARE Classic card with UID starting as: 8d690831</span><br><span class="line">Got card with UID starting as:                     a0b0e18a</span><br><span class="line">Found MIFARE Classic card:</span><br><span class="line">ISO/IEC 14443A (106 kbps) target:</span><br><span class="line">    ATQA (SENS_RES): 00  04  </span><br><span class="line">       UID (NFCID1): a0  b0  e1  8a  </span><br><span class="line">      SAK (SEL_RES): 08  </span><br><span class="line">Guessing size: seems to be a 1024-byte card</span><br><span class="line">Sent bits:     50  00  57  cd  </span><br><span class="line">Sent bits:     40 (7 bits)</span><br><span class="line">unlock failure!</span><br></pre></td></tr></table></figure>

<p>cardtocopy.dmp可以是已经准备好的dump文件</p>
<ul>
<li>Check that the card is the same</li>
</ul>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo nfc-list</span><br><span class="line">[sudo] quxr 的密码： </span><br><span class="line">nfc-list uses libnfc 1.7.1</span><br><span class="line">NFC device: pn532_uart:/dev/ttyUSB0 opened</span><br><span class="line">1 ISO14443A passive target(s) found:</span><br><span class="line">ISO/IEC 14443A (106 kbps) target:</span><br><span class="line">    ATQA (SENS_RES): 00  04  </span><br><span class="line">       UID (NFCID1): 8d  69  08  31  </span><br><span class="line">      SAK (SEL_RES): 08  </span><br></pre></td></tr></table></figure>

<ul>
<li>Go back to blank card</li>
</ul>
<p>跟格式化步骤相同，区别在于这个有cardtocopy.dmp文件提供KEY,另外那个是用mfoc现破解</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nfc-mfclassic w b blank-chinese.dmp cardtocopy.dmp f</span></span><br><span class="line">or</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nfc-mfclassic w a blank-chinese.dmp cardtocopy.dmp f</span></span><br></pre></td></tr></table></figure>

<p>经比较，这个Linux下的命令与Windows下提供的软件做出来的UID卡内容相同,CUID除了厂商信息其他都可以复制。</p>
</div></article><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2019/02/20/kali-linux/"><i class="fa fa-chevron-left">  </i><span>Kali linux</span></a></div><div class="next-post pull-right"><a href="/2018/03/22/springboot/"><span>Spring boot notes</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2025 By Ray Qu</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>