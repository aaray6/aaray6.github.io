<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="斐讯N1"><meta name="keywords" content=""><meta name="author" content="Ray Qu"><meta name="copyright" content="Ray Qu"><title>斐讯N1 | My Notes</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 7.3.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%B5%E8%A7%86%E7%9B%92"><span class="toc-number">1.</span> <span class="toc-text">电视盒</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%B8%E6%88%8F%E6%9C%BA"><span class="toc-number">2.</span> <span class="toc-text">游戏机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kodi"><span class="toc-number">3.</span> <span class="toc-text">Kodi</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NAS"><span class="toc-number">4.</span> <span class="toc-text">NAS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%99%A8"><span class="toc-number">5.</span> <span class="toc-text">路由器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Armbian"><span class="toc-number">6.</span> <span class="toc-text">Armbian</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SAMBA"><span class="toc-number">6.1.</span> <span class="toc-text">SAMBA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E5%9B%BE%E5%BD%A2%E7%95%8C%E9%9D%A2"><span class="toc-number">6.2.</span> <span class="toc-text">Docker图形界面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%82%E7%A7%BB%E5%8A%A8%E7%A1%AC%E7%9B%98"><span class="toc-number">6.3.</span> <span class="toc-text">挂移动硬盘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85Docker%E7%89%88file-browser"><span class="toc-number">6.4.</span> <span class="toc-text">安装Docker版file browser</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85Docker%E7%89%88qbittorrent"><span class="toc-number">6.5.</span> <span class="toc-text">安装Docker版qbittorrent</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85Docker%E7%89%88transmission"><span class="toc-number">6.6.</span> <span class="toc-text">安装Docker版transmission</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85Docker%E7%89%88openwrt"><span class="toc-number">6.7.</span> <span class="toc-text">安装Docker版openwrt</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%B7%E6%9D%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.7.1.</span> <span class="toc-text">混杂模式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NFS"><span class="toc-number">6.8.</span> <span class="toc-text">NFS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E6%8C%82%E4%BA%86"><span class="toc-number">6.9.</span> <span class="toc-text">系统挂了</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#U%E7%9B%98%E5%A4%87%E4%BB%BD"><span class="toc-number">6.10.</span> <span class="toc-text">U盘备份</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Ray Qu</div><div class="author-info__description text-center">My Tech Notes and Other stuff</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">78</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">My Notes</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/bookmarks">Bookmarks</a><a class="site-page" href="https://dash.ray.theworkpc.com">Dashboard</a><a class="site-page" href="/about.html">About</a><a class="site-page" href="/contact.html">Contact</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">斐讯N1</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-10-08</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>PDD上N1盒子带电源110。</p>
<p>电源:</p>
<p>盒子配的电源是12v2A。接口是5525dc线。<br>5525是5.5*2.5mm的意思<br>还有5521规格的头。内孔小一些，无法插入N1。</p>
<p>N1可以做如下事情。</p>
<p>参考</p>
<blockquote>
<p><a href="https://powersee.github.io/2020/03/n1-armbian-server/">https://powersee.github.io/2020/03/n1-armbian-server/</a></p>
</blockquote>
<h2 id="电视盒"><a href="#电视盒" class="headerlink" title="电视盒"></a>电视盒</h2><p>刷YYF ROM可以当电视盒用。必须内置刷入emmc。<br><a href="http://www.yyfrom.com/cms/">http://www.yyfrom.com/cms/</a><br><a href="http://www.yyfrom.com/cms/yyfrom/product/2021-7-3/166.html">http://www.yyfrom.com/cms/yyfrom/product/2021-7-3/166.html</a></p>
<h2 id="游戏机"><a href="#游戏机" class="headerlink" title="游戏机"></a>游戏机</h2><p>用U盘做个EmuELEC系统，引导N1可以变成游戏机。</p>
<h2 id="Kodi"><a href="#Kodi" class="headerlink" title="Kodi"></a>Kodi</h2><p>用U盘做个coreELEC系统，可以用Kodi看本地视频。</p>
<h2 id="NAS"><a href="#NAS" class="headerlink" title="NAS"></a>NAS</h2><p>内置刷入小钢炮系统，samba文件共享，内置还有docker，可以实现下载等功能。没试。</p>
<h2 id="路由器"><a href="#路由器" class="headerlink" title="路由器"></a>路由器</h2><p>刷openwrt系统做路由器。没试。</p>
<h2 id="Armbian"><a href="#Armbian" class="headerlink" title="Armbian"></a>Armbian</h2><p>用U盘刷Armbian系统，可以做Linux服务器。<br>Armbian是一个Arm64的debian Linux系统。</p>
<p>我用的是2020.11.22更新的5.9.0系统</p>
<p><a href="https://www.right.com.cn/forum/thread-4053939-1-1.html">https://www.right.com.cn/forum/thread-4053939-1-1.html</a></p>
<p>下载链接<br>链接:<a href="https://pan.baidu.com/s/1ZEwroqDhMjT1_g_DnFY9oQ">https://pan.baidu.com/s/1ZEwroqDhMjT1_g_DnFY9oQ</a><br>密码: pv4o</p>
<p>U盘写镜像文件用的是balenaEtcher Linux版(balenaEtcher-1.5.122-x64.AppImage)</p>
<p><a href="https://www.balena.io/etcher/">https://www.balena.io/etcher/</a></p>
<p>这个镜像默认安装了samba和docker。</p>
<h3 id="SAMBA"><a href="#SAMBA" class="headerlink" title="SAMBA"></a>SAMBA</h3><p>我平时操作用的是普通用户abc而不是root，所以需要给abc一些设置。</p>
<p>给用户abc加samba组sambashare</p>
<p>root:</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">usermod -a -G sambashare abc</span></span><br></pre></td></tr></table></figure>

<p>abc重新登录才可以用groups命令看到新加的组sambashare</p>
<p>在samba中增加用户abc<br>root:</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">add: (abc必须是Linux系统已经存在的系统用户)</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">smbpasswd -a abc</span></span><br><span class="line">enable:</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">smbpasswd -e abc</span></span><br><span class="line">reload:</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">smbd reload</span></span><br><span class="line">(systemctl restart smbd)</span><br><span class="line">(/etc/init.d/smbd restart)</span><br></pre></td></tr></table></figure>

<p>usershare<br>看已经share了哪些目录</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">net usershare list</span></span><br></pre></td></tr></table></figure>

<p>增加一个共享目录</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">net usershare add abc_share /home/abc/share <span class="string">&quot;abc share in home&quot;</span> everyone:R,abc:F guest_ok=y</span></span><br></pre></td></tr></table></figure>

<p>看共享目录的详细信息</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">net usershare info abc_share</span></span><br></pre></td></tr></table></figure>

<p>root级别的共享。<br>除了usershare,还可以在&#x2F;etc&#x2F;samba&#x2F;smb.conf加入以下内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[data1]</span><br><span class="line">  comment = N1 data1</span><br><span class="line">  path = /media/data1</span><br><span class="line">  public = yes</span><br><span class="line">  browsable = yes</span><br><span class="line">  guest ok = yes</span><br><span class="line">  read only = yes</span><br><span class="line">  write list = abc</span><br><span class="line">  create mask = 0755</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后重启smbd</p>
<p>创建一个名字为data1的smb共享目录。指向&#x2F;media&#x2F;data1目录。用户abc可读写。guest只读。</p>
<h3 id="Docker图形界面"><a href="#Docker图形界面" class="headerlink" title="Docker图形界面"></a>Docker图形界面</h3><p>portainer</p>
<p><a href="https://www.portainer.io/">https://www.portainer.io/</a></p>
<p>安装Linux版</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docker volume create portainer_data</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docker run -d -p 8000:8000 -p 9443:9443 --name portainer \</span></span><br><span class="line"><span class="language-bash">    --restart=always \</span></span><br><span class="line"><span class="language-bash">    -v /var/run/docker.sock:/var/run/docker.sock \</span></span><br><span class="line"><span class="language-bash">    -v portainer_data:/data \</span></span><br><span class="line"><span class="language-bash">    portainer/portainer-ce:latest</span></span><br></pre></td></tr></table></figure>

<p>访问<br><a href="https://n1/">https://N1</a> Armbian IP:9443<br>第一次登录创建用户名和密码</p>
<h3 id="挂移动硬盘"><a href="#挂移动硬盘" class="headerlink" title="挂移动硬盘"></a>挂移动硬盘</h3><p>移动硬盘不要用fat32的，最好是ntfs或者ext4。我用的ntfs。</p>
<p>root:</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">fdisk -l</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">blkid /dev/sda1</span></span><br><span class="line">/dev/sda1: LABEL=&quot;DATA&quot; UUID=&quot;580FFC0D627417F0&quot; TYPE=&quot;ntfs&quot; PTTYPE=&quot;dos&quot; PARTUUID=&quot;a4263551-01&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="built_in">cat</span> /etc/fstab</span></span><br><span class="line">LABEL=ROOTFS / ext4 defaults,noatime,nodiratime,commit=600,errors=remount-ro 0 1</span><br><span class="line">LABEL=BOOT /boot vfat defaults 0 2</span><br><span class="line">tmpfs /tmp tmpfs defaults,nosuid 0 0</span><br><span class="line">UUID=580FFC0D627417F0 /media/data1 ntfs defaults 0 0</span><br></pre></td></tr></table></figure>

<h3 id="安装Docker版file-browser"><a href="#安装Docker版file-browser" class="headerlink" title="安装Docker版file browser"></a>安装Docker版file browser</h3><p><a href="https://hub.docker.com/r/80x86/filebrowser">https://hub.docker.com/r/80x86/filebrowser</a></p>
<p>获得image</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docker pull 80x86/filebrowser</span></span><br></pre></td></tr></table></figure>

<p>运行</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">IMAGE_NAME=80x86/filebrowser</span><br><span class="line"></span><br><span class="line">WEB_PORT=8082</span><br><span class="line">FB_AUTH_SERVER_ADDR=&quot;127.0.0.1&quot;</span><br><span class="line"></span><br><span class="line">docker run -d --name fb \</span><br><span class="line">  --restart=unless-stopped \</span><br><span class="line">  -e PUID=$UID \</span><br><span class="line">  -e PGID=$GID \</span><br><span class="line">  -e WEB_PORT=$WEB_PORT \</span><br><span class="line">  -e FB_AUTH_SERVER_ADDR=$FB_AUTH_SERVER_ADDR \</span><br><span class="line">  -p $WEB_PORT:$WEB_PORT \</span><br><span class="line">  -v /media/data1:/myfiles \</span><br><span class="line">  --mount type=tmpfs,destination=/tmp \</span><br><span class="line"><span class="meta prompt_">  $</span><span class="language-bash">&#123;IMAGE_NAME&#125;</span></span><br></pre></td></tr></table></figure>

<p>访问<a href="http://n1/">http://N1</a> Armbian IP:8082<br>用户名密码admin&#x2F;admin</p>
<h3 id="安装Docker版qbittorrent"><a href="#安装Docker版qbittorrent" class="headerlink" title="安装Docker版qbittorrent"></a>安装Docker版qbittorrent</h3><p>用普通账户abc操作docker</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usermod -a -G docker abc</span><br></pre></td></tr></table></figure>

<p><a href="https://hub.docker.com/r/superng6/qbittorrent">https://hub.docker.com/r/superng6/qbittorrent</a></p>
<p>获得image</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docker pull superng6/qbittorrent</span></span><br></pre></td></tr></table></figure>

<p>运行</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">    --name=qbittorrent  \</span><br><span class="line">    -e WEBUIPORT=8080  \</span><br><span class="line">    -e HOME=/home/abc \</span><br><span class="line">    -e PUID=1000 \</span><br><span class="line">    -e PGID=1000 \</span><br><span class="line">    -e TZ=Asia/Shanghai \</span><br><span class="line">    -p 6881:6881  \</span><br><span class="line">    -p 6881:6881/udp  \</span><br><span class="line">    -p 8080:8080  \</span><br><span class="line">    -v /media/data1/qb/config:/config  \</span><br><span class="line">    -v /media/data1/qb/downloads:/downloads  \</span><br><span class="line">    --restart unless-stopped  \</span><br><span class="line">    superng6/qbittorrent:latest</span><br></pre></td></tr></table></figure>

<p>访问<a href="http://n1/">http://N1</a> Armbian IP:8080<br>用户名密码admin&#x2F;adminadmin</p>
<h3 id="安装Docker版transmission"><a href="#安装Docker版transmission" class="headerlink" title="安装Docker版transmission"></a>安装Docker版transmission</h3><p><a href="https://hub.docker.com/r/linuxserver/transmission">https://hub.docker.com/r/linuxserver/transmission</a></p>
<p>创建transmission目录和3个子目录config, downloads, watch</p>
<p>创建如下yml文件<br>docker-compose.yml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;2.1&quot;</span><br><span class="line">services:</span><br><span class="line">  transmission:</span><br><span class="line">    image: lscr.io/linuxserver/transmission</span><br><span class="line">    container_name: transmission</span><br><span class="line">    environment:</span><br><span class="line">      - PUID=1000</span><br><span class="line">      - PGID=1000</span><br><span class="line">      - TZ=Asia/Shanghai</span><br><span class="line">      - TRANSMISSION_WEB_HOME=/combustion-release/ #optional</span><br><span class="line">      - USER=abc #optional</span><br><span class="line">      - PASS=password #optional</span><br><span class="line">    volumes:</span><br><span class="line">      - /media/data1/transmission/config:/config</span><br><span class="line">      - /media/data1/transmission/downloads:/downloads</span><br><span class="line">      - /media/data1/transmission/watch:/watch</span><br><span class="line">    ports:</span><br><span class="line">      - 9091:9091</span><br><span class="line">      - 51413:51413</span><br><span class="line">      - 51413:51413/udp</span><br><span class="line">    restart: unless-stopped</span><br></pre></td></tr></table></figure>

<p>在这个文件所在目录下运行</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose pull</span><br></pre></td></tr></table></figure>

<p>下载image</p>
<p>运行</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<p>启动容器</p>
<h3 id="安装Docker版openwrt"><a href="#安装Docker版openwrt" class="headerlink" title="安装Docker版openwrt"></a>安装Docker版openwrt</h3><p><a href="https://hub.docker.com/r/unifreq/openwrt-aarch64">https://hub.docker.com/r/unifreq/openwrt-aarch64</a></p>
<p><a href="https://www.right.com.cn/forum/thread-958173-1-1.html">https://www.right.com.cn/forum/thread-958173-1-1.html</a></p>
<p>获得image</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull unifreq/openwrt-aarch64</span><br></pre></td></tr></table></figure>

<p>创建macvlan macnet (我的路由是192.168.1.1，网络是192.168.1.0&#x2F;24)<br>docker network create -d macvlan –subnet&#x3D;192.168.1.0&#x2F;24 –gateway&#x3D;192.168.1.1 -o parent&#x3D;eth0 macnet</p>
<p>运行<br>准备分配给openwrt的IP是192.168.1.31</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">IP=&quot;192.168.1.31&quot;</span><br><span class="line">MACADDR=&quot;FC:7C:02:01:02:03&quot;</span><br><span class="line">IMG_TAG=latest</span><br><span class="line">KERNEL_VERSION=$(uname -r)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">停止旧版本容器（如果存在的话）</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker stop openwrt-<span class="variable">$&#123;IMG_TAG&#125;</span></span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除旧版本容器（如果存在的话）</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker <span class="built_in">rm</span> openwrt-<span class="variable">$&#123;IMG_TAG&#125;</span></span></span><br><span class="line"></span><br><span class="line">docker run \</span><br><span class="line">        --name openwrt-$&#123;IMG_TAG&#125; \</span><br><span class="line">        --restart always \</span><br><span class="line">        --network macnet \</span><br><span class="line">        --mac-address $&#123;MACADDR&#125; \</span><br><span class="line">        --ip $&#123;IP&#125; \</span><br><span class="line">        -d \</span><br><span class="line">        --privileged=true \</span><br><span class="line">        --ulimit nofile=16384:65536  \</span><br><span class="line">        -v /lib/modules/$&#123;KERNEL_VERSION&#125;:/lib/modules/$&#123;KERNEL_VERSION&#125; \</span><br><span class="line">        unifreq/openwrt-aarch64:$IMG_TAG</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">第一次运行，需要修改ip地址</span></span><br><span class="line">docker  exec  openwrt-$&#123;IMG_TAG&#125;  sed -e &quot;s/192.168.1.1/$&#123;IP&#125;/&quot;  -i  /etc/config/network</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">重启容器生效</span></span><br><span class="line">docker restart openwrt-$&#123;IMG_TAG&#125;</span><br></pre></td></tr></table></figure>

<p>默认用户名密码root&#x2F;password<br>访问<a href="http://192.168.1.31/">http://192.168.1.31</a><br>或者ssh <a href="mailto:&#114;&#111;&#x6f;&#116;&#x40;&#49;&#57;&#x32;&#46;&#49;&#54;&#56;&#x2e;&#49;&#x2e;&#51;&#x31;">root@192.168.1.31</a></p>
<p>禁用DHCP</p>
<blockquote>
<blockquote>
<p><a href="https://openwrt.org/docs/guide-user/network/wifi/dumbap">https://openwrt.org/docs/guide-user/network/wifi/dumbap</a></p>
</blockquote>
</blockquote>
<p>Disable DHCP Server<br>If you still need dnsmasq running for something else (e.g. TFTP server) you can do:</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uci set dhcp.lan.ignore=1</span><br><span class="line">uci commit dhcp</span><br><span class="line">/etc/init.d/dnsmasq restart</span><br></pre></td></tr></table></figure>

<p>我用的是这个方法。</p>
<p>If not disable dnsmasq service:</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/dnsmasq disable</span><br><span class="line">/etc/init.d/dnsmasq stop</span><br></pre></td></tr></table></figure>

<p>这个方法尽管可以不启动dnsmasq服务。但是其他服务会用到dnsmasq,会在系统启动的时候自动把dnsmasq起来。</p>
<h4 id="混杂模式"><a href="#混杂模式" class="headerlink" title="混杂模式"></a>混杂模式</h4><p>默认host的eth0是不开混杂模式的。不开的话host和openwrt之间不能互相访问。如果需要互相访问，可以参考下面开启。</p>
<p><a href="https://leeyr.com/326.html">https://leeyr.com/326.html</a></p>
<h3 id="NFS"><a href="#NFS" class="headerlink" title="NFS"></a>NFS</h3><p>设置NFS共享</p>
<blockquote>
<p><a href="https://www.dummies.com/computers/operating-systems/linux/how-to-share-files-with-nfs-on-linux-systems/">https://www.dummies.com/computers/operating-systems/linux/how-to-share-files-with-nfs-on-linux-systems/</a><br><a href="https://unix.stackexchange.com/questions/176673/how-can-i-determine-if-an-nfs-remote-is-exporting-a-directory">https://unix.stackexchange.com/questions/176673/how-can-i-determine-if-an-nfs-remote-is-exporting-a-directory</a></p>
</blockquote>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ls -l /etc/init.d/nfs-kernel-server</span><br><span class="line"></span><br><span class="line">cat /etc/exports</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/etc/exports: the access control list <span class="keyword">for</span> filesystems <span class="built_in">which</span> may be exported</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">		to NFS clients.  See exports(5).</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Example for NFSv2 and NFSv3:</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/srv/homes       hostname1(rw,<span class="built_in">sync</span>,no_subtree_check) hostname2(ro,<span class="built_in">sync</span>,no_subtree_check)</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Example for NFSv4:</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/srv/nfs4        gss/krb5i(rw,<span class="built_in">sync</span>,fsid=0,crossmnt,no_subtree_check)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/srv/nfs4/homes  gss/krb5i(rw,<span class="built_in">sync</span>,no_subtree_check)</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"></span></span><br><span class="line">/media/data1 192.168.1.0/24(ro,insecure)</span><br><span class="line"></span><br><span class="line">exportfs -a</span><br></pre></td></tr></table></figure>

<p>Linux客户端</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">showmount -e 192.168.1.22</span></span><br><span class="line">Export list for 192.168.1.22:</span><br><span class="line">/media/data1 192.168.1.0/24</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">mount -t nfs 192.168.1.22:/media/data1 /mnt/nfs1</span></span><br></pre></td></tr></table></figure>

<h3 id="系统挂了"><a href="#系统挂了" class="headerlink" title="系统挂了"></a>系统挂了</h3><p>2023.2.7. 今天对系统盘做fsck和用gpart对磁盘进行修复的时候，导致系统起不来了。症状是重启N1没有进入armbian而是进入安卓系统。<br>可能是做以上操作时修改了分区表。</p>
<p>修复方法是找个新U盘，重新写镜像并确定能正常启动N1。然后把老的和新的U盘都插到Linux下，复制老U盘的内容到新U盘</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo cp -R /media/user/BOOT/* /media/user/BOOT1/</span><br><span class="line">sudo cp -R /media/user/ROOTFS/* /media/user/ROOTFS1/</span><br></pre></td></tr></table></figure>

<p>然后用新U盘重启N1即可。</p>
<p>系统起来之后由于文件权限问题。导致nginx的反向代理不好用。执行以下操作修复权限。</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查nginx的运行<span class="built_in">id</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ps aux | grep <span class="string">&quot;nginx: worker process&quot;</span></span></span><br><span class="line">www-data    1658  0.0  0.3  61264  6296 ?        S    13:17   0:00 nginx: worker process</span><br><span class="line">www-data    1659  0.0  0.3  61200  5652 ?        S    13:17   0:00 nginx: worker process</span><br><span class="line">www-data    1660  0.0  0.3  61132  5380 ?        S    13:17   0:00 nginx: worker process</span><br><span class="line">www-data    1661  0.0  0.3  61176  5616 ?        S    13:17   0:00 nginx: worker process</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">把权限改为www-data</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> /var/lib/nginx/</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> <span class="built_in">chown</span> -R www-data:root *</span></span><br></pre></td></tr></table></figure>

<h3 id="U盘备份"><a href="#U盘备份" class="headerlink" title="U盘备份"></a>U盘备份</h3><p>U盘插入Linux自动mount到&#x2F;media&#x2F;user&#x2F;BOOT和&#x2F;media&#x2F;user&#x2F;ROOTFS下</p>
<p>用zip命令备份。-y参数是备份符号链接为链接而不拷贝指向的文件或目录。</p>
<figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /media/user</span><br><span class="line">zip -y -r ~/tmp/BOOT.zip BOOT</span><br><span class="line">zip -y -r ~/tmp/ROOTFS.zip ROOTFS</span><br></pre></td></tr></table></figure>
</div></article><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/10/15/linux-cpu/"><i class="fa fa-chevron-left">  </i><span>linux cpu 相关工具</span></a></div><div class="next-post pull-right"><a href="/2020/07/30/anbox/"><span>anbox</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2025 By Ray Qu</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>